
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Keeping track &#8212; The DataLad Handbook</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="canonical" href="http://handbook.datalad.org/basics/101-108-run.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="DataLad, Re-Run!" href="101-109-rerun.html" />
    <link rel="prev" title="Summary" href="101-107-summary.html" />
  

  

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    div.body {
      min-width: initial;
      max-width: initial;
    }
  </style>

  
  <link rel="canonical" href="https://handbook.datalad.org/basics/101-108-run/"/>
  <meta property="og:url" content="https://handbook.datalad.org/basics/101-108-run">
  

  <link rel="icon" type="image/png" href="https://media.readthedocs.org/images/favicon.png">

  <meta name="twitter:card" content="summary">
  <meta property="twitter:image" content="https://handbook.datalad.org/_static/social-card.jpg">
  <meta property="og:image" content="https://handbook.datalad.org/_static/social-card.jpg">
  <meta property="og:title" content="Keeping track &#8212; The DataLad Handbook">
  <meta property="og:type" content="article">
  
  <meta property="og:description" content="">


  </head><body>
  <script type="text/javascript">

  $(window).scroll(function () {
    var s = $(window).scrollTop(),
          d = $(document).height(),
          c = $(window).height();
          scrollPercent = (s / (d-c)) * 100;
          var position = scrollPercent;

     $("#progressbar").attr('value', position);
  });
  </script>

  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/logo.png" title="The DataLad Handbook"/>
  </a>
</p>

<p style="margin-left:auto; margin-right: auto;"><iframe src="https://ghbtns.com/github-btn.html?repo=book&user=datalad-handbook&type=star&count=true&size=large" allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe></p>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
<style>
.algolia-autocomplete{
  width: 100%;
  height: 1.5em
}
.algolia-autocomplete a{
  border-bottom: none !important;
}
#doc_search{
  width: 100%;
  height: 100%;
}
</style>

<progress id="progressbar" value="0" max="100"></progress><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="101-107-summary.html" title="previous chapter">Summary</a></li>
      <li>Next: <a href="101-109-rerun.html" title="next chapter">DataLad, Re-Run!</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><!-- Alabaster (krTheme++) Hacks -->
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            <div style="display:block;position:relative; margin-bottom: 1em;">
              <div style="display:block;width:100%;padding-top:12.5%;"></div>
              <div class="rpad" data-unit="8x1" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;"></div>
            </div>
            
  <div class="section" id="keeping-track">
<span id="run"></span><h1>Keeping track<a class="headerlink" href="#keeping-track" title="Permalink to this headline">¶</a></h1>
<p>In previous examples, all changes that happened to the dataset or
the files it contains were
saved to the dataset’s history by hand. We added larger and smaller
files and saved them, and we also modified smaller file contents and
saved these modifications.</p>
<p>Often, however, files get changed by shell commands
or by scripts.
Consider a <a class="reference external" href="https://xkcd.com/1838/">data scientist</a>.
She has data files with numeric data,
and code scripts in Python, R, Matlab or any other programming language
that will use the data to compute results or figures. Such output is
stored in new files, or modifies existing files.</p>
<p>But only a few weeks after these scripts were executed she finds it hard
to remember which script was modified for which reason or created which
output. How did this result came to be? Which script would she need
to run again on which data to produce this particular figure?</p>
<p>In this section we will experience how DataLad can help
to record the changes in a dataset after execution of a script
from the shell.</p>
<p>Let’s say, for example, that you enjoyed the longnow podcasts a lot,
and you start a podcast-night with friends to wind down from all of
the exciting DataLad lectures. They propose to make a
list of speakers and titles to cross out what they’ve already listened
to, and ask you to prepare such a list.</p>
<p>“Mhh… probably there is a DataLad way to do this… wasn’t there also
a note about metadata extraction at some point?” But as we’re not that
far into the lectures, you decide to write a simple shell script
to generate a text file that lists speaker and title
name instead.</p>
<p>To do this, we’re following a best practice that will reappear in the
later section on <a class="reference external" href="101-123-yoda.html">YODA principles</a> : Collecting all
additional scripts that work with content of a subdataset <em>outside</em>
of this subdataset, in a dedicated <code class="docutils literal notranslate"><span class="pre">code/</span></code> directory,
and collating the output of the execution of these scripts
<em>outside</em> of the subdataset as well – and
therefore not modifying the subdataset.</p>
<p>The motivation behind this will become clear in later sections,
but for now we’ll start with best-practice building.
Therefore, create a subdirectory <code class="docutils literal notranslate"><span class="pre">code/</span></code> in the <code class="docutils literal notranslate"><span class="pre">DataLad-101</span></code>
superdataset:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> mkdir code
<span class="gp">$</span> tree -d
<span class="go">.</span>
<span class="go">├── books</span>
<span class="go">├── code</span>
<span class="go">└── recordings</span>
<span class="go">    └── longnow</span>
<span class="go">        ├── Long_Now__Conversations_at_The_Interval</span>
<span class="go">        └── Long_Now__Seminars_About_Long_term_Thinking</span>

<span class="go">6 directories</span>
</pre></div>
</div>
<p>Inside of <code class="docutils literal notranslate"><span class="pre">Datalad-101/code</span></code>, create a simple shell script <code class="docutils literal notranslate"><span class="pre">list_titles.sh</span></code>.
This script will carry out a simple task:
It will loop through the file names of the <code class="docutils literal notranslate"><span class="pre">.mp3</span></code> files and
write out speaker names and talk titles in a very simple fashion.
The content of this script is written below – the <code class="docutils literal notranslate"><span class="pre">cat</span></code> command
will write it into the script.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> cat &lt;&lt; EOT &gt; code/list_titles.sh
<span class="go">for i in recordings/longnow/Long_Now__Seminars*/*.mp3; do</span>
<span class="gp">   #</span> get the filename
<span class="go">   base=\$(basename &quot;\$i&quot;);</span>
<span class="gp">   #</span> strip the extension
<span class="go">   base=\${base%.mp3};</span>
<span class="gp">   #</span> date as yyyy-mm-dd
<span class="go">   printf &quot;\${base%%__*}\t&quot; | tr &#39;_&#39; &#39;-&#39;;</span>
<span class="gp">   #</span> name and title without underscores
<span class="go">   printf &quot;\${base#*__}\n&quot; | tr &#39;_&#39; &#39; &#39;;</span>
<span class="go">done</span>
<span class="go">EOT</span>
</pre></div>
</div>
<p>Save this script to the dataset.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad status
<span class="go">untracked: code (directory)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad save -m <span class="s2">&quot;Add simple script to write a list of podcast speakers and titles&quot;</span>
<span class="go">add(ok): code/list_titles.sh (file)</span>
<span class="go">save(ok): . (dataset)</span>
<span class="go">action summary:</span>
<span class="go">  add (ok: 1)</span>
<span class="go">  save (ok: 1)</span>
</pre></div>
</div>
<p>Once we run this script, it will simply print dates, names and titles to
your terminal. We can save its outputs to a new file
<code class="docutils literal notranslate"><span class="pre">recordings/podcasts.tsv</span></code> in the superdataset by redirecting these
outputs with <code class="docutils literal notranslate"><span class="pre">bash</span> <span class="pre">code/list_titles.sh</span> <span class="pre">&gt;</span> <span class="pre">recordings/podcasts.tsv</span></code>.</p>
<p>Obviously, we could create this file, and subsequently save it to the superdataset.
However, just as in the example about the data scientist,
in a bit of time, we will forget how this file came into existence, or
that the script <code class="docutils literal notranslate"><span class="pre">code/list_titles.sh</span></code> is associated with this file, and
can be used to update it later on.</p>
<p id="index-0">The <strong class="command">datalad run</strong> command (<em class="manpage"><a class="manpage reference external" href="http://docs.datalad.org/generated/man/datalad-run.html">datalad-run</a></em> manual)
can help with this. It records a command’s impact on a dataset.</p>
<p>Let’s try the simplest way to use this command: <strong class="command">datalad run</strong>,
followed by a commit message (<code class="docutils literal notranslate"><span class="pre">-m</span> <span class="pre">&quot;a</span> <span class="pre">concise</span> <span class="pre">summary&quot;</span></code>), and the
command that executes the script from the shell: <code class="docutils literal notranslate"><span class="pre">bash</span> <span class="pre">code/list_titles.sh</span></code>.
It is helpful to enclose the command in quotation marks.</p>
<p>Note that we execute the command from the root of the superdataset.
It is recommended to use <strong class="command">datalad run</strong> in the root of the dataset
you want to record the changes in, so make sure to run this
command from the root of <code class="docutils literal notranslate"><span class="pre">DataLad-101</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad run -m <span class="s2">&quot;create a list of podcast titles&quot;</span> <span class="s2">&quot;bash code/list_titles.sh &gt; recordings/podcasts.tsv&quot;</span>
<span class="go">[INFO] == Command start (output follows) ===== </span>
<span class="go">[INFO] == Command exit (modification check follows) ===== </span>
<span class="go">add(ok): recordings/podcasts.tsv (file)</span>
<span class="go">save(ok): . (dataset)</span>
<span class="go">action summary:</span>
<span class="go">  add (ok: 1)</span>
<span class="go">  save (notneeded: 1, ok: 1)</span>
</pre></div>
</div>
<div class="toggle findoutmore docutils container">
<div class="header docutils container">
<p><strong>Find out more: </strong>Why is there a “notneeded” in the command summary?</p>
</div>
<p>If you have stumbled across the command execution summary
<code class="docutils literal notranslate"><span class="pre">save</span> <span class="pre">(notneeded:</span> <span class="pre">1,</span> <span class="pre">ok:</span> <span class="pre">1)</span></code> and wondered what is “notneeded”:
the <strong class="command">datalad save</strong> at the end of a <strong class="command">datalad run</strong> will query all potential
subdatasets <em>recursively</em> for modifications, and as there are no
modifications in the <code class="docutils literal notranslate"><span class="pre">longnow</span></code> subdataset, this part of <code class="docutils literal notranslate"><span class="pre">save</span></code> returns
a “notneeded” summary. Thus, after a <strong class="command">datalad run</strong>, you’ll get a
“notneeded” for every subdataset with no modifications in the execution
summary.</p>
</div>
<p>Let’s take a look into the history:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git log -p -n <span class="m">1</span>
<span class="go">commit ecde4e4b41d219728bc3f2b28adf2f33b366c533</span>
<span class="go">Author: Elena Piscopia &lt;elena@example.net&gt;</span>
<span class="go">Date:   Tue Nov 12 15:05:21 2019 +0100</span>

<span class="hll"><span class="go">    [DATALAD RUNCMD] create a list of podcast titles</span>
</span><span class="go">    </span>
<span class="go">    === Do not change lines below ===</span>
<span class="go">    {</span>
<span class="go">     &quot;chain&quot;: [],</span>
<span class="hll"><span class="go">     &quot;cmd&quot;: &quot;bash code/list_titles.sh &gt; recordings/podcasts.tsv&quot;,</span>
</span><span class="go">     &quot;dsid&quot;: &quot;686444f8-0555-11ea-98f1-e86a64c8054c&quot;,</span>
<span class="go">     &quot;exit&quot;: 0,</span>
<span class="go">     &quot;extra_inputs&quot;: [],</span>
<span class="go">     &quot;inputs&quot;: [],</span>
<span class="go">     &quot;outputs&quot;: [],</span>
<span class="go">     &quot;pwd&quot;: &quot;.&quot;</span>
<span class="go">    }</span>
<span class="go">    ^^^ Do not change lines above ^^^</span>

<span class="go">diff --git a/recordings/podcasts.tsv b/recordings/podcasts.tsv</span>
<span class="go">new file mode 100644</span>
<span class="go">index 0000000..f691b53</span>
<span class="go">--- /dev/null</span>
<span class="hll"><span class="go">+++ b/recordings/podcasts.tsv</span>
</span><span class="go">@@ -0,0 +1,206 @@</span>
<span class="go">+2003-11-15	Brian Eno  The Long Now</span>
<span class="go">+2003-12-13	Peter Schwartz  The Art Of The Really Long View</span>
<span class="go">+2004-01-10	George Dyson  There s Plenty of Room at the Top  Long term Thinking About Large scale Computing</span>
<span class="go">+2004-02-14	James Dewar  Long term Policy Analysis</span>
</pre></div>
</div>
<p>The commit message we have supplied with <code class="docutils literal notranslate"><span class="pre">-m</span></code> directly after <strong class="command">datalad run</strong> appears
in our history as a short summary.
Additionally, the output of the command, <code class="docutils literal notranslate"><span class="pre">recordings/podcasts.tsv</span></code>,
was saved right away.</p>
<p>But there is more in this log entry, a section in between the markers</p>
<p><code class="docutils literal notranslate"><span class="pre">===</span> <span class="pre">Do</span> <span class="pre">not</span> <span class="pre">change</span> <span class="pre">lines</span> <span class="pre">below</span> <span class="pre">===</span></code> and</p>
<p><code class="docutils literal notranslate"><span class="pre">^^^</span> <span class="pre">Do</span> <span class="pre">not</span> <span class="pre">change</span> <span class="pre">lines</span> <span class="pre">above</span> <span class="pre">^^^</span></code>.</p>
<p>This is the so-called <code class="docutils literal notranslate"><span class="pre">run</span> <span class="pre">record</span></code> – a recording of all of the
information in the <strong class="command">datalad run</strong> command, generated by DataLad.
In this case, it is a very simple summary. One informative
part is highlighted:
<code class="docutils literal notranslate"><span class="pre">&quot;cmd&quot;:</span> <span class="pre">&quot;bash</span> <span class="pre">code/list_titles.sh&quot;</span></code> is the command that was run
in the terminal.
This information therefore maps the command, and with it the script,
to the output file, in one commit. Nice, isn’t it?</p>
<p>Arguably, the <a class="reference internal" href="../glossary.html#term-run-record"><span class="xref std std-term">run record</span></a> is not the most human-readable way to display information.
This representation however is less for the human user (the human user should
rely on their informative commit message), but for DataLad, in particular for the
<strong class="command">datalad rerun</strong> command, which you will see in action shortly.</p>
<p>Note that any <strong class="command">datalad run</strong> command that does not result in any changes
in a dataset (no modification of existing content; no additional files)
will not produce any record in the dataset’s history. Try to run the exact same
command as before, and check whether anything in your log changes:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad run -m <span class="s2">&quot;Try again to create a list of podcast titles&quot;</span> <span class="s2">&quot;bash code/list_titles.sh &gt; recordings/podcasts.tsv&quot;</span>
<span class="go">[INFO] == Command start (output follows) ===== </span>
<span class="go">[INFO] == Command exit (modification check follows) ===== </span>
<span class="go">action summary:</span>
<span class="go">  save (notneeded: 2)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git log --oneline
<span class="hll"><span class="go">ecde4e4 [DATALAD RUNCMD] create a list of podcast titles</span>
</span><span class="go">ef8b726 Add simple script to write a list of podcast speakers and titles</span>
<span class="go">e61c229 Add note on datalad install</span>
<span class="go">49e85d1 [DATALAD] Recorded changes</span>
</pre></div>
</div>
<p>The most recent commit is still the <strong class="command">datalad run</strong> command from before,
and there was no second <strong class="command">datalad run</strong> commit created.</p>
<p>The <strong class="command">datalad run</strong> can therefore help you to keep track of what you are doing
in a dataset. The next sections will demonstrate how to make use of this information,
and also how to extend the command with additional arguments that will prove to
be helpful over the course of this chapter.</p>
</div>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="101-107-summary.html" title="Previous document">Summary</a>
        </li>
        <li>
          <a href="101-109-rerun.html" title="Next document">DataLad, Re-Run!</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>

  </body>
</html>