
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Configurations to go &#8212; The DataLad Handbook</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="canonical" href="http://handbook.datalad.org/basics/101-127-procedures.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Summary" href="101-128-summary.html" />
    <link rel="prev" title="More on DIY configurations" href="101-126-config2.html" />
  

  

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    div.body {
      min-width: initial;
      max-width: initial;
    }
  </style>

  
  <link rel="canonical" href="https://handbook.datalad.org/basics/101-127-procedures/"/>
  <meta property="og:url" content="https://handbook.datalad.org/basics/101-127-procedures">
  

  <link rel="icon" type="image/png" href="https://media.readthedocs.org/images/favicon.png">

  <meta name="twitter:card" content="summary">
  <meta property="twitter:image" content="https://handbook.datalad.org/_static/social-card.jpg">
  <meta property="og:image" content="https://handbook.datalad.org/_static/social-card.jpg">
  <meta property="og:title" content="Configurations to go &#8212; The DataLad Handbook">
  <meta property="og:type" content="article">
  
  <meta property="og:description" content="">


  </head><body>
  <script type="text/javascript">

  $(window).scroll(function () {
    var s = $(window).scrollTop(),
          d = $(document).height(),
          c = $(window).height();
          scrollPercent = (s / (d-c)) * 100;
          var position = scrollPercent;

     $("#progressbar").attr('value', position);
  });
  </script>

  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/logo.png" title="The DataLad Handbook"/>
  </a>
</p>

<p style="margin-left:auto; margin-right: auto;"><iframe src="https://ghbtns.com/github-btn.html?repo=book&user=datalad-handbook&type=star&count=true&size=large" allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe></p>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
<style>
.algolia-autocomplete{
  width: 100%;
  height: 1.5em
}
.algolia-autocomplete a{
  border-bottom: none !important;
}
#doc_search{
  width: 100%;
  height: 100%;
}
</style>

<progress id="progressbar" value="0" max="100"></progress>
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Configurations to go</a><ul>
<li><a class="reference internal" href="#applying-procedures">Applying procedures</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="101-126-config2.html" title="previous chapter">More on DIY configurations</a></li>
      <li>Next: <a href="101-128-summary.html" title="next chapter">Summary</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><!-- Alabaster (krTheme++) Hacks -->
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            <div style="display:block;position:relative; margin-bottom: 1em;">
              <div style="display:block;width:100%;padding-top:12.5%;"></div>
              <div class="rpad" data-unit="8x1" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;"></div>
            </div>
            
  <div class="section" id="configurations-to-go">
<span id="procedures"></span><h1>Configurations to go<a class="headerlink" href="#configurations-to-go" title="Permalink to this headline">¶</a></h1>
<p>The past two sections should have given you a comprehensive
overview on the different configuration options the tools
Git, Git-annex, and DataLad provide. They not only
showed you a way to configure everything you may need to
configure, but also gave explanations about what the
configuration options actually mean.</p>
<p>But figuring out which configurations are useful and how
to apply them are also not the easiest tasks. Therefore,
some clever people decided to assist with
these tasks, and created pre-configured <em>procedures</em>
that process datasets in a particular way.
These procedures can be shipped within DataLad or its extensions,
lie on a system, or can be shared together with datasets.</p>
<p>One of such procedures is the <code class="docutils literal notranslate"><span class="pre">text2git</span></code> configuration.
In order to learn about procedures in general, let’s demystify
what the <code class="docutils literal notranslate"><span class="pre">text2git</span></code> procedure exactly is: It is
nothing more than a simple script that</p>
<ul class="simple">
<li><p>writes the relevant configuration (<code class="docutils literal notranslate"><span class="pre">annex_largefiles</span> <span class="pre">=</span> <span class="pre">'(not(mimetype=text/*))'</span></code>,
i.e., “Do not put anything that is a text file in the annex”)
to the <code class="docutils literal notranslate"><span class="pre">.gitattributes</span></code> file of a dataset, and</p></li>
<li><p>saves this modification with the commit message
“Instruct annex to add text files to Git”.</p></li>
</ul>
<p>This particular procedure lives in a script called
<code class="docutils literal notranslate"><span class="pre">cfg_text2git</span></code> in the sourcecode of DataLad. The amount of code
in this script is not large, and the relevant lines of code
are highlighted:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span> import sys
 import os.path as op
 from datalad.distribution.dataset import require_dataset

 <span class="nv">ds</span> <span class="o">=</span> require_dataset<span class="o">(</span>
     sys.argv<span class="o">[</span><span class="m">1</span><span class="o">]</span>,
     <span class="nv">check_installed</span><span class="o">=</span>True,
     <span class="nv">purpose</span><span class="o">=</span><span class="s1">&#39;configuration&#39;</span><span class="o">)</span>

 <span class="c1"># the relevant configuration:</span>
<span class="hll"> <span class="nv">annex_largefiles</span> <span class="o">=</span> <span class="s1">&#39;(not(mimetype=text/*))&#39;</span>
</span> <span class="c1"># check existing configurations:</span>
 <span class="nv">attrs</span> <span class="o">=</span> ds.repo.get_gitattributes<span class="o">(</span><span class="s1">&#39;*&#39;</span><span class="o">)</span>
 <span class="c1"># if not already an existing configuration, configure Git-annex with the above rule</span>
 <span class="k">if</span> not attrs.get<span class="o">(</span><span class="s1">&#39;*&#39;</span>, <span class="o">{})</span>.get<span class="o">(</span>
         <span class="s1">&#39;annex.largefiles&#39;</span>, None<span class="o">)</span> <span class="o">==</span> annex_largefiles:
<span class="hll">     ds.repo.set_gitattributes<span class="o">([</span>
</span><span class="hll">         <span class="o">(</span><span class="s1">&#39;*&#39;</span>, <span class="o">{</span><span class="s1">&#39;annex.largefiles&#39;</span>: annex_largefiles<span class="o">})])</span>
</span>
 <span class="c1"># this saves and commits the changed .gitattributes file</span>
 <span class="nv">git_attributes_file</span> <span class="o">=</span> op.join<span class="o">(</span>ds.path, <span class="s1">&#39;.gitattributes&#39;</span><span class="o">)</span>
 ds.save<span class="o">(</span>
     git_attributes_file,
     <span class="nv">message</span><span class="o">=</span><span class="s2">&quot;Instruct annex to add text files to Git&quot;</span>,
 <span class="o">)</span>
</pre></div>
</div>
<p>Just like <code class="docutils literal notranslate"><span class="pre">cfg_text2git</span></code>, all DataLad procedures are
executables (such as a script, or compiled code).
In principle, they can be written in any language, and perform
any task inside of a dataset.
The <code class="docutils literal notranslate"><span class="pre">text2git</span></code> configuration for example applies a configuration for how
Git-annex treats different file types. Other procedures do not
only modify <code class="docutils literal notranslate"><span class="pre">.gitattributes</span></code>, but can also populate a dataset
with particular content, or automate routine tasks such as
synchronizing dataset content with certain siblings.
What makes them a particularly versatile and flexible tool is
that anyone can write their own procedures. If a workflow is
a standard in a team and needs to be applied often, turning it into
a script can save time and effort. By pointing DataLad
to the location the procedures reside in they can be applied, and by
including them in a dataset they can even be shared.
And even if the script is simple, it is very handy to have preconfigured
procedures that can be run in a single command line call. In the
case of <code class="docutils literal notranslate"><span class="pre">text2git</span></code>, all text files in a dataset will be stored
in Git – this is a useful configuration that is applicable to a
wide range of datasets. It is a shortcut that
spares naive users the necessity to learn about the <code class="docutils literal notranslate"><span class="pre">.gitattributes</span></code>
file when setting up a dataset.</p>
<p id="index-0">To find out available procedures, the command
<strong class="command">datalad run-procedure --discover</strong> (<em class="manpage"><a class="manpage reference external" href="http://docs.datalad.org/generated/man/datalad-run-procedure.html">datalad-run-procedure</a></em>
manual) is helpful.
This command will make DataLad search the default location for
procedures in a dataset, the source code of DataLad or
installed DataLad extensions, and the default locations for
procedures on the system for available procedures:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad run-procedure --discover
<span class="go">cfg_bids (../../../adina/repos/datalad-neuroimaging/datalad_neuroimaging/resources/procedures/cfg_bids.py) [python_script]</span>
<span class="go">cfg_metadatatypes (../../../adina/repos/datalad/datalad/resources/procedures/cfg_metadatatypes.py) [python_script]</span>
<span class="go">cfg_text2git (../../../adina/repos/datalad/datalad/resources/procedures/cfg_text2git.py) [python_script]</span>
<span class="go">cfg_yoda (../../../adina/repos/datalad/datalad/resources/procedures/cfg_yoda.py) [python_script]</span>
</pre></div>
</div>
<p>The output shows that in this particular dataset, on the particular
system the book is written on, there are at least three procedures available:
<code class="docutils literal notranslate"><span class="pre">cfg_metadatatypes</span></code>, <code class="docutils literal notranslate"><span class="pre">cfg_text2git</span></code>, and <code class="docutils literal notranslate"><span class="pre">cfg_yoda</span></code>.
It also lists where they are stored – in this case,
they are all part of the source code of DataLad<a class="footnote-reference brackets" href="#f1" id="id1">1</a>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cfg_yoda</span></code> configures a dataset according to the yoda
principles – the section <a class="reference internal" href="101-123-yoda.html#yoda"><span class="std std-ref">YODA: Best practices for data analyses in a dataset</span></a> talks about this in detail.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cfg_text2git</span></code> configures text files to be stored in Git.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cfg_metadatatypes</span></code> lets users configure additional metadata
types – more about this in a later section on DataLads metadata
handling.</p></li>
</ul>
<div class="section" id="applying-procedures">
<h2>Applying procedures<a class="headerlink" href="#applying-procedures" title="Permalink to this headline">¶</a></h2>
<p><strong class="command">datalad run-procedure</strong> not only <em>discovers</em>
but also <em>executes</em> procedures. If given the name of
a procedure, this command will apply the procedure to
the current dataset, or the dataset that is specified
with the <code class="docutils literal notranslate"><span class="pre">-d/--dataset</span></code> flag:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">datalad</span> <span class="n">run</span><span class="o">-</span><span class="n">procedure</span> <span class="p">[</span><span class="o">-</span><span class="n">d</span> <span class="o">&lt;</span><span class="n">PATH</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">cfg_text2git</span>
</pre></div>
</div>
<p>The typical workflow is to create a dataset and apply
a procedure afterwards.
However, some procedures shipped with DataLad or its extensions with a
<code class="docutils literal notranslate"><span class="pre">cfg_</span></code> prefix can also be applied right at the creation of a dataset
with the <code class="docutils literal notranslate"><span class="pre">-c/--cfg-proc</span> <span class="pre">&lt;name&gt;</span></code> option in a <strong class="command">datalad create</strong>
command. This is a peculiarity of these procedures because, by convention,
all of these procedures are written to not require arguments.
The command structure looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">datalad</span> <span class="n">create</span> <span class="o">-</span><span class="n">c</span> <span class="n">text2git</span> <span class="n">DataLad</span><span class="o">-</span><span class="mi">101</span>
</pre></div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">cfg_</span></code> prefix of the procedures is omitted in these
calls to keep it extra simple and short. The
available procedures in this example (<code class="docutils literal notranslate"><span class="pre">cfg_yoda</span></code>, <code class="docutils literal notranslate"><span class="pre">cfg_text2git</span></code>)
could thus be applied within a <strong class="command">datalad create</strong> as</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">datalad</span> <span class="pre">create</span> <span class="pre">-c</span> <span class="pre">yoda</span> <span class="pre">&lt;DSname&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">datalad</span> <span class="pre">create</span> <span class="pre">-c</span> <span class="pre">text2git</span> <span class="pre">&lt;DSname&gt;</span></code></p></li>
</ul>
<div class="toggle findoutmore docutils container">
<div class="header docutils container">
<p><strong>Find out more: </strong>Applying procedures in subdatasets</p>
</div>
<p>Procedures can be applied in datasets on any level in the dataset hierarchy, i.e.,
also in subdatasets. Note, though, that a subdataset will show up as being
<code class="docutils literal notranslate"><span class="pre">modified</span></code> in <strong class="command">datalad status</strong> <em>in the superdataset</em>
after applying a procedure.
This is expected, and it would also be the case with any other modification
(saved or not) in the subdataset, as the version of the subdataset that is tracked
in the superdataset simply changed. A <strong class="command">datalad save</strong> in the superdataset
will make sure that the version of the subdataset gets updated in the superdataset.</p>
</div>
<p>As a general note, it can be useful to apply procedures
early in the life of a dataset. Procedures such
as <code class="docutils literal notranslate"><span class="pre">cfg_yoda</span></code> (explained in detail in section <a class="reference internal" href="101-123-yoda.html#yoda"><span class="std std-ref">YODA: Best practices for data analyses in a dataset</span></a>),
create files, change <code class="docutils literal notranslate"><span class="pre">.gitattributes</span></code>, or apply other configurations.
If many other (possibly complex) configurations are
already in place, or if files of the same name as the ones created by
a procedure are already in existence, this can lead to unexpected
problems or failures, especially for naive users. Applying <code class="docutils literal notranslate"><span class="pre">cfg_text2git</span></code>
to a default dataset in which one has saved many text files already
(as per default added to the annex) will not place the existing, saved
files into Git – only those text files created <em>after</em> the configuration
was applied.</p>
<div class="toggle findoutmore docutils container">
<div class="header docutils container">
<p><strong>Find out more: </strong>Write your own procedures</p>
</div>
<p>Procedures can come with DataLad or its extensions, but anyone can
write their own ones in addition, and deploy them on individual machines,
or ship them within DataLad datasets. This allows to
automate routine configurations or tasks in a dataset.
Some general rules for creating a custom procedure are outlined
below:</p>
<ul>
<li><p>A procedure can be any executable. Executables must have the
appropriate permissions and, in the case of a script,
must contain an appropriate <a class="reference internal" href="../glossary.html#term-shebang"><span class="xref std std-term">shebang</span></a>.</p>
<blockquote>
<div><ul class="simple">
<li><p>If a procedure is not executable, but its filename ends with
<code class="docutils literal notranslate"><span class="pre">.sh</span></code>, it is automatically executed via <a class="reference internal" href="../glossary.html#term-bash"><span class="xref std std-term">bash</span></a>.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Procedures can implement any argument handling, but must be capable
of taking at least one positional argument (the absolute path to the
dataset they shall operate on).</p></li>
<li><p>Custom procedures rely heavily on configurations in <code class="docutils literal notranslate"><span class="pre">.datalad/config</span></code>
(or the associated environment variables). Within <code class="docutils literal notranslate"><span class="pre">.datalad/config</span></code>,
each procedure should get an individual entry that contains at least
a short “help” description on what the procedure does. Below is a minimal
<code class="docutils literal notranslate"><span class="pre">.datalad/config</span></code> entry for a custom procedure:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>datalad <span class="s2">&quot;procedures.&lt;NAME&gt;&quot;</span><span class="o">]</span>
   <span class="nb">help</span> <span class="o">=</span> <span class="s2">&quot;This is a string to describe what the procedure does&quot;</span>
</pre></div>
</div>
</li>
<li><p>By default, on GNU/Linux systems, DataLad will search for system-wide procedures
(i.e., procedures on the <em>system</em> level) in <code class="docutils literal notranslate"><span class="pre">/etc/xdg/datalad/procedures</span></code>,
for user procedures (i.e., procedures on the <em>global</em> level) in <code class="docutils literal notranslate"><span class="pre">~/.config/datalad/procedures</span></code>,
and for dataset procedures (i.e., the <em>local</em> level<a class="footnote-reference brackets" href="#f2" id="id2">2</a>) in <code class="docutils literal notranslate"><span class="pre">.datalad/procedures</span></code>
relative to a dataset root.
Note that <code class="docutils literal notranslate"><span class="pre">.datalad/procedures</span></code> does not exist by default, and the <code class="docutils literal notranslate"><span class="pre">procedures</span></code>
directory needs to be created first.</p>
<blockquote>
<div><ul>
<li><p>Alternatively to the default locations, DataLad can be pointed to the
location of a procedure with a configuration in <code class="docutils literal notranslate"><span class="pre">.datalad/config</span></code>
(or with the help of the associated <a class="reference internal" href="../glossary.html#term-environment-variable"><span class="xref std std-term">environment variable</span></a>s).
The appropriate configuration keys for <code class="docutils literal notranslate"><span class="pre">.datalad/config</span></code> are either
<code class="docutils literal notranslate"><span class="pre">datalad.locations.system-procedures</span></code> (for changing the <em>system</em> default),
<code class="docutils literal notranslate"><span class="pre">datalad.locations.user-procedures</span></code> (for changing the <em>global</em> default),
or <code class="docutils literal notranslate"><span class="pre">datalad.locations.dataset-procedures</span></code> (for changing the <em>local</em> default).
An example <code class="docutils literal notranslate"><span class="pre">.datalad/config</span></code> entry for the local scope is shown below.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>datalad <span class="s2">&quot;locations&quot;</span><span class="o">]</span>
    dataset-procedures <span class="o">=</span> relative/path/from/dataset-root
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<blockquote>
<div><ul>
<li><p>By default, DataLad will call a procedure with a standard template
defined by a format string:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interpreter</span> <span class="p">{</span><span class="n">script</span><span class="p">}</span> <span class="p">{</span><span class="n">ds</span><span class="p">}</span> <span class="p">{</span><span class="n">arguments</span><span class="p">}</span>
</pre></div>
</div>
<p>where arguments can be any additional command line arguments a script
(procedure) takes or requires. This default format string can be
customized within <code class="docutils literal notranslate"><span class="pre">.datalad/config</span></code> in <code class="docutils literal notranslate"><span class="pre">datalad.procedures.&lt;NAME&gt;.call-format</span></code>.
An example <code class="docutils literal notranslate"><span class="pre">.datalad/config</span></code> entry with a changed call format string
is shown below.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>datalad <span class="s2">&quot;procedures.&lt;NAME&gt;&quot;</span><span class="o">]</span>
   <span class="nb">help</span> <span class="o">=</span> <span class="s2">&quot;This is a string to describe what the procedure does&quot;</span>
   call-format <span class="o">=</span> <span class="s2">&quot;python {script} {ds} {somearg1} {somearg2}&quot;</span>
</pre></div>
</div>
</li>
<li><p>By convention, procedures should leave a dataset in a clean state.</p></li>
</ul>
</div></blockquote>
<p>Therefore, in order to create a custom procedure, an executable script
in the appropriate location is fine. Placing a script <code class="docutils literal notranslate"><span class="pre">myprocedure</span></code>
into <code class="docutils literal notranslate"><span class="pre">.datalad/procedures</span></code> will allow running
<code class="docutils literal notranslate"><span class="pre">datalad</span> <span class="pre">run-procedure</span> <span class="pre">myprocedure</span></code> in your dataset, and because
it is part of the dataset it will also allow distributing the procedure.
Below is a toy-example for a custom procedure:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad create somedataset<span class="p">;</span> <span class="nb">cd</span> somedataset
<span class="go">[INFO] Creating a new annex repo at /home/me/procs/somedataset</span>
<span class="go">create(ok): /home/me/procs/somedataset (dataset)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> mkdir .datalad/procedures
<span class="gp">$</span> cat &lt;&lt; EOT &gt; .datalad/procedures/example.py
<span class="go">&quot;&quot;&quot;A simple procedure to create a file &#39;example&#39; and store</span>
<span class="go">it in Git, and a file &#39;example2&#39; and annex it. The contents</span>
<span class="go">of &#39;example&#39; must be defined with a positional argument.&quot;&quot;&quot;</span>

<span class="go">import sys</span>
<span class="go">import os.path as op</span>
<span class="go">from datalad.distribution.dataset import require_dataset</span>
<span class="go">from datalad.utils import create_tree</span>

<span class="go">ds = require_dataset(</span>
<span class="go">    sys.argv[1],</span>
<span class="go">    check_installed=True,</span>
<span class="go">    purpose=&#39;showcase an example procedure&#39;)</span>

<span class="gp">#</span> this is the content <span class="k">for</span> file <span class="s2">&quot;example&quot;</span>
<span class="go">content = &quot;&quot;&quot;\</span>
<span class="go">This file was created by a custom procedure! Neat, huh?</span>
<span class="go">&quot;&quot;&quot;</span>

<span class="gp">#</span> create a directory structure template. Write
<span class="go">tmpl = {</span>
<span class="go">    &#39;somedir&#39;: {</span>
<span class="go">        &#39;example&#39;: content,</span>
<span class="go">    },</span>
<span class="go">    &#39;example2&#39;: sys.argv[2] if sys.argv[2] else &quot;got no input&quot;</span>
<span class="go">}</span>

<span class="gp">#</span> actually create the structure in the dataset
<span class="go">create_tree(ds.path, tmpl)</span>

<span class="gp">#</span> rule to store <span class="s1">&#39;example&#39;</span> Git
<span class="go">ds.repo.set_gitattributes([(&#39;example&#39;, {&#39;annex.largefiles&#39;: &#39;nothing&#39;})])</span>

<span class="gp">#</span> save the dataset modifications
<span class="go">ds.save(message=&quot;Apply custom procedure&quot;)</span>

<span class="go">EOT</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad save -m <span class="s2">&quot;add custom procedure&quot;</span>
<span class="go">add(ok): .datalad/procedures/example.py (file)</span>
<span class="go">save(ok): . (dataset)</span>
<span class="go">action summary:</span>
<span class="go">  add (ok: 1)</span>
<span class="go">  save (ok: 1)</span>
</pre></div>
</div>
<p>At this point, the dataset contains the custom procedure <code class="docutils literal notranslate"><span class="pre">example</span></code>.
This is how it can be executed and what it does:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad run-procedure example <span class="s2">&quot;this text will be in the file &#39;example2&#39;&quot;</span>
<span class="go">[INFO] Running procedure example </span>
<span class="go">[INFO] == Command start (output follows) ===== </span>
<span class="go">[INFO] == Command exit (modification check follows) ===== </span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span>the directory structure has been created
<span class="gp">$</span> tree
<span class="go">.</span>
<span class="go">├── example2 -&gt; .git/annex/objects/G6/zw/MD5E-s40--2ed1bce0db9f376c277a1ba6418f3ddd/MD5E-s40--2ed1bce0db9f376c277a1ba6418f3ddd</span>
<span class="go">└── somedir</span>
<span class="go">    └── example</span>

<span class="go">1 directory, 2 files</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span>lets check out the contents in the files
<span class="gp">$</span> cat example2  <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s1">&#39;&#39;</span> <span class="o">&amp;&amp;</span> cat somedir/example
<span class="go">this text will be in the file &#39;example2&#39;</span>
<span class="go">This file was created by a custom procedure! Neat, huh?</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git config -f .datalad/config datalad.procedures.example.help <span class="s2">&quot;A toy example&quot;</span>
<span class="gp">$</span> datalad save -m <span class="s2">&quot;add help description&quot;</span>
<span class="go">add(ok): .datalad/config (file)</span>
<span class="go">save(ok): . (dataset)</span>
<span class="go">action summary:</span>
<span class="go">  add (ok: 1)</span>
<span class="go">  save (ok: 1)</span>
</pre></div>
</div>
<p>To find out more about a given procedure, you can ask for help:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad run-procedure --help-proc example
<span class="go">example (.datalad/procedures/example.py)</span>
<span class="go">A toy example</span>
</pre></div>
</div>
<div class="admonition-todo admonition" id="id3">
<p class="admonition-title">Todo</p>
<p>It might be helpful to have (or reference) a table with all available
procedures and a short explanation. Maybe on the cheatsheet.</p>
</div>
</div>
<p>Summing up, DataLads <strong class="command">run-procedure</strong> command is a handy tool
with useful existing procedures but much flexibility for own
DIY procedure scripts. With the information of the last three sections
you should be able to write and understand necessary configurations,
but you can also rely on existing, preconfigured templates in the
form of procedures, and even write and distribute your own.</p>
<p>Therefore, envision procedures as
helper-tools that can minimize technical complexities
in a dataset – users can concentrate on the actual task while
the dataset is set-up, structured, processed, or configured automatically
with the help of a procedure.
Especially in the case of trainees and new users, applying procedures
instead of doing relevant routines “by hand” can help to ease
working with the dataset, as the use case <a class="reference internal" href="../usecases/supervision.html#usecase-student-supervision"><span class="std std-ref">Student supervision in a research project</span></a>
showcases.</p>
<p>Finally, make a note about running procedures inside of <code class="docutils literal notranslate"><span class="pre">notes.txt</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> cat &lt;&lt; EOT &gt;&gt; notes.txt
<span class="go">It can be useful to use pre-configured procedures that can apply</span>
<span class="go">configurations, create files or file hierarchies, or perform</span>
<span class="go">arbitrary tasks in datasets. They can be shipped with DataLad,</span>
<span class="go">its extensions, or datasets, and you can even write your own</span>
<span class="go">procedures and distribute them. The &quot;datalad run-procedure&quot;</span>
<span class="go">command is used to apply such a procedure to a dataset. Procedures</span>
<span class="go">shipped with DataLad or its extensions starting with a &quot;cfg&quot; prefix</span>
<span class="go">can also be applied at the creation of a dataset with</span>
<span class="go">&quot;datalad create -c &lt;PROC-NAME&gt; &lt;PATH&gt;&quot; (omitting the &quot;cfg&quot; prefix).</span>

<span class="go">EOT</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad save -m <span class="s2">&quot;add note on DataLads procedures&quot;</span>
<span class="go">add(ok): notes.txt (file)</span>
<span class="go">save(ok): . (dataset)</span>
<span class="go">action summary:</span>
<span class="go">  add (ok: 1)</span>
<span class="go">  save (ok: 1)</span>
</pre></div>
</div>
<p class="rubric">Footnotes</p>
<dl class="footnote brackets">
<dt class="label" id="f1"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>In theory, because procedures can exist on different levels, and
because anyone can create (and thus name) their own procedures, there
can be name conflicts. The order of precedence in such cases is:
user-level, system-level, dataset, DataLad extension, DataLad, i.e.,
local procedures take precedence over those coming from “outside” via
datasets or datalad extensions.
If procedures in a higher-level dataset and a subdataset have the same
name, the procedure closer to the dataset <code class="docutils literal notranslate"><span class="pre">run-procedure</span></code> is
operating on takes precedence.</p>
</dd>
<dt class="label" id="f2"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>Note that we simplify the level of procedures that exist within a dataset
by calling them <em>local</em>. Even though they apply to a dataset just as <em>local</em>
Git configurations, unlike Git’s <em>local</em> configurations in <code class="docutils literal notranslate"><span class="pre">.git/config</span></code>,
the procedures and procedure configurations in <code class="docutils literal notranslate"><span class="pre">.datalad/config</span></code> are committed
and can be shared together with a dataset. The procedure level <em>local</em> therefore
does not exactly corresponds to the <em>local</em> scope in the sense that Git uses it.</p>
</dd>
</dl>
</div>
</div>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="101-126-config2.html" title="Previous document">More on DIY configurations</a>
        </li>
        <li>
          <a href="101-128-summary.html" title="Next document">Summary</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>

  </body>
</html>