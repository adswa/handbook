
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Miscellaneous file system operations &#8212; The DataLad Handbook</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="canonical" href="http://handbook.datalad.org/basics/101-136-filesystem.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Back and forth in time" href="101-137-history.html" />
    <link rel="prev" title="How to get help" href="101-135-help.html" />
  

  

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    div.body {
      min-width: initial;
      max-width: initial;
    }
  </style>

  
  <link rel="canonical" href="https://handbook.datalad.org/basics/101-136-filesystem/"/>
  <meta property="og:url" content="https://handbook.datalad.org/basics/101-136-filesystem">
  

  <link rel="icon" type="image/png" href="https://media.readthedocs.org/images/favicon.png">

  <meta name="twitter:card" content="summary">
  <meta property="twitter:image" content="https://handbook.datalad.org/_static/social-card.jpg">
  <meta property="og:image" content="https://handbook.datalad.org/_static/social-card.jpg">
  <meta property="og:title" content="Miscellaneous file system operations &#8212; The DataLad Handbook">
  <meta property="og:type" content="article">
  
  <meta property="og:description" content="">


  </head><body>
  <script type="text/javascript">

  $(window).scroll(function () {
    var s = $(window).scrollTop(),
          d = $(document).height(),
          c = $(window).height();
          scrollPercent = (s / (d-c)) * 100;
          var position = scrollPercent;

     $("#progressbar").attr('value', position);
  });
  </script>

  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/logo.png" title="The DataLad Handbook"/>
  </a>
</p>

<p style="margin-left:auto; margin-right: auto;"><iframe src="https://ghbtns.com/github-btn.html?repo=book&user=datalad-handbook&type=star&count=true&size=large" allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe></p>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
<style>
.algolia-autocomplete{
  width: 100%;
  height: 1.5em
}
.algolia-autocomplete a{
  border-bottom: none !important;
}
#doc_search{
  width: 100%;
  height: 100%;
}
</style>

<progress id="progressbar" value="0" max="100"></progress>
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Miscellaneous file system operations</a><ul>
<li><a class="reference internal" href="#renaming-files">Renaming files</a></li>
<li><a class="reference internal" href="#moving-files-from-or-into-subdirectories">Moving files from or into subdirectories</a></li>
<li><a class="reference internal" href="#copying-files">Copying files</a></li>
<li><a class="reference internal" href="#moving-renaming-a-subdirectory-or-subdataset">Moving/renaming a subdirectory or subdataset</a></li>
<li><a class="reference internal" href="#moving-renaming-a-superdataset">Moving/renaming a superdataset</a></li>
<li><a class="reference internal" href="#deleting-annexed-files-directories">Deleting (annexed) files/directories</a><ul>
<li><a class="reference internal" href="#removing-a-file-but-keeping-content-in-history">Removing a file, but keeping content in history</a></li>
<li><a class="reference internal" href="#removing-annexed-content-entirely">Removing annexed content entirely</a></li>
</ul>
</li>
<li><a class="reference internal" href="#uninstalling-or-deleting-subdatasets">Uninstalling or deleting subdatasets</a></li>
<li><a class="reference internal" href="#deleting-a-superdataset">Deleting a superdataset</a></li>
<li><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="101-135-help.html" title="previous chapter">How to get help</a></li>
      <li>Next: <a href="101-137-history.html" title="next chapter">Back and forth in time</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><!-- Alabaster (krTheme++) Hacks -->
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            <div style="display:block;position:relative; margin-bottom: 1em;">
              <div style="display:block;width:100%;padding-top:12.5%;"></div>
              <div class="rpad" data-unit="8x1" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;"></div>
            </div>
            
  <div class="section" id="miscellaneous-file-system-operations">
<span id="filesystem"></span><h1>Miscellaneous file system operations<a class="headerlink" href="#miscellaneous-file-system-operations" title="Permalink to this headline">¶</a></h1>
<p>With all of the information about symlinks and object trees,
you might be reluctant to perform usual file system managing
operations, such as copying, moving, renaming or deleting
files or directories with annexed content.</p>
<p>If I renamed one of those books, would the symlink that points
to the file content still be correct? What happens if I’d copy
an annexed file?
If I moved the whole <code class="docutils literal notranslate"><span class="pre">books/</span></code> directory? What if I moved
all of <code class="docutils literal notranslate"><span class="pre">DataLad-101</span></code> into a different place on my computer?
What if renamed the whole superdataset?
And how do I remove a file, or directory, or subdataset?</p>
<p>Therefore, there is an extra tutorial offered by the courses’
TA today, and you attend.
There is no better way of learning than doing. Here, in the
safe space of the <code class="docutils literal notranslate"><span class="pre">DataLad-101</span></code> course, you can try out all
of the things you would be unsure about or reluctant to try
on the dataset that contains your own, valuable data.</p>
<p>Below you will find common questions about file system
management operations, and each question outlines caveats and
solutions with code examples you can paste into your own terminal.
Because these code snippets will add many commits to your
dataset, we’re cleaning up within each segment with
common git operations that manipulate the datasets
history – be sure to execute these commands as well (and
be sure to be in the correct dataset).</p>
<div class="section" id="renaming-files">
<h2>Renaming files<a class="headerlink" href="#renaming-files" title="Permalink to this headline">¶</a></h2>
<p>Let’s try it. In Unix, renaming a file is exactly the same as
moving a file, and uses the <strong class="command">mv</strong> command.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> books/
<span class="gp">$</span> mv TLCL.pdf The_Linux_Command_Line.pdf
<span class="gp">$</span> ls -lah
<span class="go">total 20K</span>
<span class="go">drwxr-xr-x 2 adina adina 4.0K Nov 12 15:05 .</span>
<span class="go">drwxr-xr-x 7 adina adina 4.0K Nov 12 15:05 ..</span>
<span class="go">lrwxrwxrwx 1 adina adina  131 Nov 12 15:05 byte-of-python.pdf -&gt; ../.git/annex/objects/ZZ/f1/MD5E-s4407669--32e6b03a08a6edda12ad42eb7bb06a5c.pdf/MD5E-s4407669--32e6b03a08a6edda12ad42eb7bb06a5c.pdf</span>
<span class="go">lrwxrwxrwx 1 adina adina  133 Jun 29 17:39 progit.pdf -&gt; ../.git/annex/objects/G6/Gj/MD5E-s12465653--05cd7ed561d108c9bcf96022bc78a92c.pdf/MD5E-s12465653--05cd7ed561d108c9bcf96022bc78a92c.pdf</span>
<span class="go">lrwxrwxrwx 1 adina adina  131 Jan 28  2019 The_Linux_Command_Line.pdf -&gt; ../.git/annex/objects/jf/3M/MD5E-s2120211--06d1efcb05bb2c55cd039dab3fb28455.pdf/MD5E-s2120211--06d1efcb05bb2c55cd039dab3fb28455.pdf</span>
</pre></div>
</div>
<p>Try to open the renamed file, e.g., with
<code class="docutils literal notranslate"><span class="pre">evince</span> <span class="pre">The_Linux_Command_Line.pdf</span></code>.
This works!</p>
<p>But let’s see what changed in the dataset with this operation:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad status
<span class="go">untracked: /home/me/dl-101/DataLad-101/books/The_Linux_Command_Line.pdf (symlink)</span>
<span class="go">  deleted: /home/me/dl-101/DataLad-101/books/TLCL.pdf (symlink)</span>
</pre></div>
</div>
<p>We can see that the old file is marked as <code class="docutils literal notranslate"><span class="pre">deleted</span></code>, and
simultaneously, an <code class="docutils literal notranslate"><span class="pre">untracked</span></code> file appears: the renamed
PDF.</p>
<p>While this might appear messy, a <code class="docutils literal notranslate"><span class="pre">datalad</span> <span class="pre">save</span></code> will clean
all of this up. Therefore, do not panic if you rename a file,
and see a dirty dataset status with deleted and untracked files
– <code class="docutils literal notranslate"><span class="pre">datalad</span> <span class="pre">save</span></code> handles these and other cases really well
under the hood.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad save -m <span class="s2">&quot;rename the book&quot;</span>
<span class="go">delete(ok): books/TLCL.pdf (file)</span>
<span class="go">add(ok): books/The_Linux_Command_Line.pdf (file)</span>
<span class="go">save(ok): . (dataset)</span>
<span class="go">action summary:</span>
<span class="go">  add (ok: 1)</span>
<span class="go">  delete (ok: 1)</span>
<span class="go">  save (ok: 1)</span>
</pre></div>
</div>
<p>The <strong class="command">datalad save</strong> command will identify that a file was
renamed, and will summarize this nicely in the resulting commit:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git log -1 -p
<span class="go">commit 1e73e54127769872ee863986b9363e1ca47ab285</span>
<span class="go">Author: Elena Piscopia &lt;elena@example.net&gt;</span>
<span class="go">Date:   Tue Nov 12 15:05:47 2019 +0100</span>

<span class="go">    rename the book</span>

<span class="hll"><span class="go">diff --git a/books/TLCL.pdf b/books/The_Linux_Command_Line.pdf</span>
</span><span class="hll"><span class="go">similarity index 100%</span>
</span><span class="hll"><span class="go">rename from books/TLCL.pdf</span>
</span><span class="hll"><span class="go">rename to books/The_Linux_Command_Line.pdf</span>
</span></pre></div>
</div>
<p>Note that <strong class="command">datalad save</strong> commits all modifications when
it’s called without a path specification,
so any other changes will be saved in the same commit as the rename.
If there are unsaved modifications you do not want to commit
together with the file name change, you could give both the
new and the deleted file as a path specification to
<strong class="command">datalad save</strong>, even if it feels unintuitive to
save a change that is marked as a deletion in a
<strong class="command">datalad status</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">datalad</span> <span class="n">save</span> <span class="o">-</span><span class="n">m</span> <span class="s2">&quot;rename file&quot;</span> <span class="n">oldname</span> <span class="n">newname</span>
</pre></div>
</div>
<p>Alternatively, there is also a way to save the name change
only using Git tools only, outlined in the following hidden
section. If you are a Git user, you will be very familiar with it.</p>
<div class="toggle docutils container">
<div class="header docutils container">
<p><strong>Find out more:</strong> Renaming with Git tools</p>
</div>
<p>Git has built-in commands that provide a solution in two steps.</p>
<p>If you have followed along with the previous <strong class="command">datalad save</strong>
(which you should have), let’s revert the renaming of the the files:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git reset --hard HEAD~1
<span class="gp">$</span> datalad status
<span class="go">HEAD is now at 110f3d9 add note on DataLads procedures</span>
</pre></div>
</div>
<p>Now we’re checking out how to rename files and commit this operation
using only Git:
A Git-specific way to rename files is the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">mv</span></code> command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git mv TLCL.pdf The_Linux_Command_Line.pdf
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad status
<span class="go">    added: /home/me/dl-101/DataLad-101/books/The_Linux_Command_Line.pdf (file)</span>
<span class="go">  deleted: /home/me/dl-101/DataLad-101/books/TLCL.pdf (file)</span>
</pre></div>
</div>
<p>We can see that the old file is still seen as “deleted”, but the “new”,
renamed file is “added”. A <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">status</span></code> displays the change
in the dataset a bit more accurately:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git status
<span class="go">On branch master</span>
<span class="go">Changes to be committed:</span>
<span class="go">  (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span>

<span class="go">	renamed:    TLCL.pdf -&gt; The_Linux_Command_Line.pdf</span>
</pre></div>
</div>
<p>Because the <strong class="command">git mv</strong> places the change directly into the
staging area (the <em>index</em>) of Git<a class="footnote-reference brackets" href="#f1" id="id1">1</a>,
a subsequent <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">commit</span> <span class="pre">-m</span> <span class="pre">&quot;rename</span> <span class="pre">book&quot;</span></code> will write the renaming
– and only the renaming – to the dataset’s history, even if other
(unstaged) modifications are present.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git commit -m <span class="s2">&quot;rename book&quot;</span>
<span class="go">[master 78ae503] rename book</span>
<span class="go"> 1 file changed, 0 insertions(+), 0 deletions(-)</span>
<span class="go"> rename books/{TLCL.pdf =&gt; The_Linux_Command_Line.pdf} (100%)</span>
</pre></div>
</div>
</div>
<p>To summarize, renaming files is easy and worry-free. Do not be intimidated
by a file marked as deleted – a <strong class="command">datalad save</strong> will rectify this.
Be mindful of other modifications in your dataset, though, and either supply
appropriate paths to <code class="docutils literal notranslate"><span class="pre">datalad</span> <span class="pre">save</span></code>, or use Git tools to exclusively save
the name change and nothing else.</p>
<p>Let’s revert this now, to have a clean history.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git reset --hard HEAD~1
<span class="gp">$</span> datalad status
<span class="go">HEAD is now at 110f3d9 add note on DataLads procedures</span>
</pre></div>
</div>
</div>
<div class="section" id="moving-files-from-or-into-subdirectories">
<h2>Moving files from or into subdirectories<a class="headerlink" href="#moving-files-from-or-into-subdirectories" title="Permalink to this headline">¶</a></h2>
<p>Let’s move an annexed file from within <code class="docutils literal notranslate"><span class="pre">books/</span></code> into the root
of the superdataset:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> mv TLCL.pdf ../TLCL.pdf
<span class="gp">$</span> datalad status
<span class="go">untracked: /home/me/dl-101/DataLad-101/TLCL.pdf (symlink)</span>
<span class="go">  deleted: /home/me/dl-101/DataLad-101/books/TLCL.pdf (symlink)</span>
</pre></div>
</div>
<p>In general, this looks exactly like renaming or moving a file
in the same directory. There is a subtle difference though:
Currently, the symlink of the annexed file is broken. There
are two ways to demonstrate this. One is trying to open the
file – this will currently fail. The second way is to look
at the symlink:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> ../
<span class="gp">$</span> ls -l TLCL.pdf
<span class="go">lrwxrwxrwx 1 adina adina 131 Nov 12 15:05 TLCL.pdf -&gt; ../.git/annex/objects/jf/3M/MD5E-s2120211--06d1efcb05bb2c55cd039dab3fb28455.pdf/MD5E-s2120211--06d1efcb05bb2c55cd039dab3fb28455.pdf</span>
</pre></div>
</div>
<p>The first part of the symlink should point into the <code class="docutils literal notranslate"><span class="pre">.git/</span></code>
directory, but currently, it does not – the symlink still looks
like <code class="docutils literal notranslate"><span class="pre">TLCL.pdf</span></code> would be within <code class="docutils literal notranslate"><span class="pre">books/</span></code>. Instead of pointing
into <code class="docutils literal notranslate"><span class="pre">.git</span></code>, it currently points to <code class="docutils literal notranslate"><span class="pre">../.git</span></code>, which is non-existent,
and even outside of the superdataset. This is why the file
cannot be opened: When any program tries to follow the symlink,
it will not resolve, and an error such as “no file or directory”
will be returned. But do not panic! A <strong class="command">datalad save</strong> will
rectify this as well:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad save -m <span class="s2">&quot;moved book into root&quot;</span>
<span class="gp">$</span> ls -l TLCL.pdf
<span class="go">delete(ok): books/TLCL.pdf (file)</span>
<span class="go">add(ok): TLCL.pdf (file)</span>
<span class="go">save(ok): . (dataset)</span>
<span class="go">action summary:</span>
<span class="go">  add (ok: 1)</span>
<span class="go">  delete (ok: 1)</span>
<span class="go">  save (ok: 1)</span>
<span class="go">lrwxrwxrwx 1 adina adina 128 Nov 12 15:05 TLCL.pdf -&gt; .git/annex/objects/jf/3M/MD5E-s2120211--06d1efcb05bb2c55cd039dab3fb28455.pdf/MD5E-s2120211--06d1efcb05bb2c55cd039dab3fb28455.pdf</span>
</pre></div>
</div>
<p>After a <code class="docutils literal notranslate"><span class="pre">datalad</span> <span class="pre">save</span></code>, the symlink is fixed again.
Therefore, in general, whenever moving or renaming a file,
especially between directories, a <code class="docutils literal notranslate"><span class="pre">datalad</span> <span class="pre">save</span></code> is
the best option to turn to.</p>
<div class="toggle docutils container">
<div class="header docutils container">
<p><strong>Find out more:</strong> Why a move between directories is actually a content change</p>
</div>
<p>Let’s see how this shows up in the dataset history:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git log -1 -p
<span class="go">commit 57619f689e1674654e9418d1d07ebb0531ba1d8d</span>
<span class="go">Author: Elena Piscopia &lt;elena@example.net&gt;</span>
<span class="go">Date:   Tue Nov 12 15:05:48 2019 +0100</span>

<span class="go">    moved book into root</span>

<span class="go">diff --git a/TLCL.pdf b/TLCL.pdf</span>
<span class="go">new file mode 120000</span>
<span class="go">index 0000000..34328e2</span>
<span class="go">--- /dev/null</span>
<span class="go">+++ b/TLCL.pdf</span>
<span class="go">@@ -0,0 +1 @@</span>
<span class="go">+.git/annex/objects/jf/3M/MD5E-s2120211--06d1efcb05bb2c55cd039dab3fb28455.pdf/MD5E-s2120211--06d1efcb05bb2c55cd039dab3fb28455.pdf</span>
<span class="go">\ No newline at end of file</span>
<span class="go">diff --git a/books/TLCL.pdf b/books/TLCL.pdf</span>
<span class="go">deleted file mode 120000</span>
<span class="go">index 4c84b61..0000000</span>
<span class="go">--- a/books/TLCL.pdf</span>
<span class="go">+++ /dev/null</span>
<span class="go">@@ -1 +0,0 @@</span>
<span class="go">-../.git/annex/objects/jf/3M/MD5E-s2120211--06d1efcb05bb2c55cd039dab3fb28455.pdf/MD5E-s2120211--06d1efcb05bb2c55cd039dab3fb28455.pdf</span>
<span class="go">\ No newline at end of file</span>
</pre></div>
</div>
<p>As you can see, this action does not show up as a move, but instead
a deletion and addition of a new file. Why? Because the content
that is tracked is the actual symlink, and due to the change in
relative location, the symlink needed to change. Hence, what looks
and feels like a move on the file system for you is actually a
move plus a content change for Git.</p>
<p>An additional piece of background information: A <strong class="command">datalad save</strong> command
internally uses a <strong class="command">git commit</strong> to save changes to a dataset.
<strong class="command">git commit</strong> in turn triggers a <strong class="command">git annex fix</strong>
command. This Git-annex command fixes up links that have become broken
to again point to annexed content, and is responsible for cleaning up
what needs to be cleaned up. Thanks, Git-annex!</p>
</div>
<p>Therefore, while it might be startling
if you’ve moved a file and can not open it directly afterwards, everything
will be rectified by <strong class="command">datalad save</strong> as well.</p>
<p>Finally, let’s clean up:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git reset --hard HEAD~1
<span class="go">HEAD is now at 110f3d9 add note on DataLads procedures</span>
</pre></div>
</div>
</div>
<div class="section" id="copying-files">
<h2>Copying files<a class="headerlink" href="#copying-files" title="Permalink to this headline">¶</a></h2>
<p>Let’s create a copy of an annexed file, using the Unix
command <code class="docutils literal notranslate"><span class="pre">cp</span></code> to copy.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> cp books/TLCL.pdf copyofTLCL.pdf
<span class="gp">$</span> datalad status
<span class="go">untracked: copyofTLCL.pdf (file)</span>
</pre></div>
</div>
<p>That’s expected. The copy shows up as a new, untracked
file. Let’s save it:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad save -m <span class="s2">&quot;add copy of TLCL.pdf&quot;</span>
<span class="go">add(ok): copyofTLCL.pdf (file)</span>
<span class="go">save(ok): . (dataset)</span>
<span class="go">action summary:</span>
<span class="go">  add (ok: 1)</span>
<span class="go">  save (ok: 1)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git log -1 -p
<span class="go">commit 082577f3c24e6fb0c46c8fe8ed119d82e74ea3c4</span>
<span class="go">Author: Elena Piscopia &lt;elena@example.net&gt;</span>
<span class="go">Date:   Tue Nov 12 15:05:48 2019 +0100</span>

<span class="go">    add copy of TLCL.pdf</span>

<span class="go">diff --git a/copyofTLCL.pdf b/copyofTLCL.pdf</span>
<span class="go">new file mode 120000</span>
<span class="go">index 0000000..34328e2</span>
<span class="go">--- /dev/null</span>
<span class="go">+++ b/copyofTLCL.pdf</span>
<span class="go">@@ -0,0 +1 @@</span>
<span class="go">+.git/annex/objects/jf/3M/MD5E-s2120211--06d1efcb05bb2c55cd039dab3fb28455.pdf/MD5E-s2120211--06d1efcb05bb2c55cd039dab3fb28455.pdf</span>
<span class="go">\ No newline at end of file</span>
</pre></div>
</div>
<p>That’s it.</p>
<div class="toggle docutils container">
<div class="header docutils container">
<p><strong>Find out more:</strong> Symlinks!</p>
</div>
<p>If you have read the additional content in the section
<a class="reference internal" href="101-115-symlinks.html#symlink"><span class="std std-ref">Data integrity</span></a>, you know that the same file content
is only stored once, and copies of the same file point to
the same location in the object tree.</p>
<p>Let’s check that out:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ls -l copyofTLCL.pdf
<span class="gp">$</span> ls -l books/TLCL.pdf
<span class="go">lrwxrwxrwx 1 adina adina 128 Nov 12 15:05 copyofTLCL.pdf -&gt; .git/annex/objects/jf/3M/MD5E-s2120211--06d1efcb05bb2c55cd039dab3fb28455.pdf/MD5E-s2120211--06d1efcb05bb2c55cd039dab3fb28455.pdf</span>
<span class="go">lrwxrwxrwx 1 adina adina 131 Nov 12 15:05 books/TLCL.pdf -&gt; ../.git/annex/objects/jf/3M/MD5E-s2120211--06d1efcb05bb2c55cd039dab3fb28455.pdf/MD5E-s2120211--06d1efcb05bb2c55cd039dab3fb28455.pdf</span>
</pre></div>
</div>
<p>Indeed! Apart from their relative location (<code class="docutils literal notranslate"><span class="pre">.git</span></code> versus
<code class="docutils literal notranslate"><span class="pre">../.git</span></code>) their symlink is identical. Thus, even though two
copies of the book exist in your dataset, your disk needs to
store it only once.</p>
<p>In most cases, this is just an interesting fun-fact, but beware
when dropping content with <strong class="command">datalad drop</strong>
(<a class="reference internal" href="#remove"><span class="std std-ref">Removing annexed content entirely</span></a>):
If you drop the content of one copy of a file, all
other copies will lose this content as well.</p>
</div>
<p>Finally, let’s clean up:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git reset --hard HEAD~1
<span class="go">HEAD is now at 110f3d9 add note on DataLads procedures</span>
</pre></div>
</div>
</div>
<div class="section" id="moving-renaming-a-subdirectory-or-subdataset">
<h2>Moving/renaming a subdirectory or subdataset<a class="headerlink" href="#moving-renaming-a-subdirectory-or-subdataset" title="Permalink to this headline">¶</a></h2>
<p>Moving or renaming subdirectories, especially if they are subdatasets,
<em>can</em> be a minefield. But in principle, a safe way to proceed is using
the Unix <strong class="command">mv</strong> command to move or rename, and the <strong class="command">datalad save</strong>
to clean up afterwards, just as in the examples above. Make sure to
<strong>not</strong> use <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">mv</span></code>, especially for subdatasets.</p>
<p>Let’s for example rename the <code class="docutils literal notranslate"><span class="pre">books</span></code> directory:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> mv books/ readings
<span class="gp">$</span> datalad status
<span class="go">untracked: readings (directory)</span>
<span class="go">  deleted: books/TLCL.pdf (symlink)</span>
<span class="go">  deleted: books/byte-of-python.pdf (symlink)</span>
<span class="go">  deleted: books/progit.pdf (symlink)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad save -m <span class="s2">&quot;renamed directory&quot;</span>
<span class="go">delete(ok): books/TLCL.pdf (file)</span>
<span class="go">delete(ok): books/byte-of-python.pdf (file)</span>
<span class="go">delete(ok): books/progit.pdf (file)</span>
<span class="go">add(ok): readings/TLCL.pdf (file)</span>
<span class="go">add(ok): readings/byte-of-python.pdf (file)</span>
<span class="go">add(ok): readings/progit.pdf (file)</span>
<span class="go">save(ok): . (dataset)</span>
<span class="go">action summary:</span>
<span class="go">  add (ok: 3)</span>
<span class="go">  delete (ok: 3)</span>
<span class="go">  save (ok: 1)</span>
</pre></div>
</div>
<p>This is easy, and complication free. Moving (as in: changing the location, instead of
the name) the directory would work in the
same fashion, and a <strong class="command">datalad save</strong> would fix broken symlinks afterwards.
Let’s quickly clean this up:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git reset --hard HEAD~1
<span class="go">HEAD is now at 110f3d9 add note on DataLads procedures</span>
</pre></div>
</div>
<p>But let’s now try to move the <code class="docutils literal notranslate"><span class="pre">longnow</span></code> subdataset into the root of the
superdataset:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> mv recordings/longnow .
<span class="gp">$</span> datalad status
<span class="go">untracked: longnow (directory)</span>
<span class="go">  deleted: recordings/longnow (dataset)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad save -m <span class="s2">&quot;moved subdataset&quot;</span>
<span class="go">delete(ok): recordings/longnow (file)</span>
<span class="go">add(ok): longnow (file)</span>
<span class="go">add(ok): .gitmodules (file)</span>
<span class="go">save(ok): . (dataset)</span>
<span class="go">action summary:</span>
<span class="go">  add (ok: 2)</span>
<span class="go">  delete (ok: 1)</span>
<span class="go">  save (ok: 1)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad status
</pre></div>
</div>
<p>This seems fine, and it has indeed worked.
However, <em>reverting</em> a commit like this is tricky, at the moment. This could
lead to trouble if you at a later point try to revert or rebase chunks of your
history including this move. Therefore, if you can, try not to move subdatasets
around. For now we’ll clean up in a somewhat “hacky” way: Reverting, and
moving remaining subdataset contents back to their original place by hand
to take care of the unwanted changes the commit reversal introduced.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git reset --hard HEAD~1
<span class="go">warning: unable to rmdir &#39;longnow&#39;: Directory not empty</span>
<span class="go">HEAD is now at 110f3d9 add note on DataLads procedures</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> mv -f longnow recordings
</pre></div>
</div>
<p>The take-home message therefore is that it is best not to move subdatasets,
but very possible to move subdirectories if necessary. In both cases, do not
attempt moving with the <strong class="command">git mv</strong>, but stick with <strong class="command">mv</strong> and
a subsequent <strong class="command">datalad save</strong>.</p>
<div class="admonition-todo admonition" id="id2">
<p class="admonition-title">Todo</p>
<p>Update this when progress has been made towards
<a class="reference external" href="https://github.com/datalad/datalad/issues/3464">https://github.com/datalad/datalad/issues/3464</a></p>
</div>
</div>
<div class="section" id="moving-renaming-a-superdataset">
<h2>Moving/renaming a superdataset<a class="headerlink" href="#moving-renaming-a-superdataset" title="Permalink to this headline">¶</a></h2>
<p>Once created, a DataLad superdataset may not be in an optimal
place on your file system, or have the best name.</p>
<p>After a while, you might think that the dataset would fit much
better into <code class="docutils literal notranslate"><span class="pre">/home/user/research_projects/</span></code> than in
<code class="docutils literal notranslate"><span class="pre">/home/user/Documents/MyFiles/tmp/datalad-test/</span></code>. Or maybe at
some point, a long name such as <code class="docutils literal notranslate"><span class="pre">My-very-first-DataLad-project-wohoo-I-am-so-excited</span></code>
does not look pretty in your terminal prompt anymore, and going for
<code class="docutils literal notranslate"><span class="pre">finance-2019</span></code> seems more professional.</p>
<p>These will be situations in which you want to rename or move
a superdataset. Will that break anything?</p>
<p>In all standard situations, no, it will be completely fine.
You can use standard Unix commands such as <code class="docutils literal notranslate"><span class="pre">mv</span></code> to do it,
and also whichever graphical user interface or explorer you may
use.</p>
<p>Beware of one thing though: If your dataset either is a sibling
or has a sibling with the source being a path, moving or renaming
the dataset will break the linkage between the datasets. This can
be fixed easily though. We can try this in the following hidden
section.</p>
<div class="toggle docutils container">
<div class="header docutils container">
<p><strong>Find out more:</strong> If a renamed/moved dataset is a sibling…</p>
</div>
<p>As section <a class="reference internal" href="101-125-config.html#config"><span class="std std-ref">DIY configurations</span></a> explains, each
sibling is registered in <code class="docutils literal notranslate"><span class="pre">.git/config</span></code> in a “submodule” section.
Let’s look at how our sibling “roommate” is registered there:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> cat .git/config
<span class="go">[core]</span>
<span class="go">	repositoryformatversion = 0</span>
<span class="go">	filemode = true</span>
<span class="go">	bare = false</span>
<span class="go">	logallrefupdates = true</span>
<span class="go">	editor = nano</span>
<span class="go">[annex]</span>
<span class="go">	uuid = 8c154892-26d4-4130-bbe0-51c49154ad55</span>
<span class="go">	version = 5</span>
<span class="go">	backends = MD5E</span>
<span class="go">[submodule &quot;recordings/longnow&quot;]</span>
<span class="go">	url = https://github.com/datalad-datasets/longnow-podcasts.git</span>
<span class="hll"><span class="go">	active = true</span>
</span><span class="hll"><span class="go">[remote &quot;roommate&quot;]</span>
</span><span class="go">	url = ../mock_user/DataLad-101</span>
<span class="go">	fetch = +refs/heads/*:refs/remotes/roommate/*</span>
<span class="go">	annex-uuid = 00a600d7-8535-4f76-abf5-93639b0f4ad5</span>
<span class="go">	annex-ignore = false</span>
<span class="go">[submodule &quot;longnow&quot;]</span>
<span class="go">	url = https://github.com/datalad-datasets/longnow-podcasts.git</span>
<span class="go">	active = true</span>
</pre></div>
</div>
<p>As you can see, its “url” is specified as a relative path. Say your
room mate’s directory is a dataset you would want to move. Let’s see
what happens if we move the dataset such that the path does not point
to the dataset anymore:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> add an intermediate directory
<span class="gp">$</span> <span class="nb">cd</span> ../mock_user
<span class="gp">$</span> mkdir onemoredir
<span class="gp">#</span> move your room mates dataset into this new directory
<span class="gp">$</span> mv DataLad-101 onemoredir
</pre></div>
</div>
<p>This means that relative to your <code class="docutils literal notranslate"><span class="pre">DataLad-101</span></code>, your room mates
dataset is not at <code class="docutils literal notranslate"><span class="pre">../mock_user/DataLad-101</span></code> anymore, but in
<code class="docutils literal notranslate"><span class="pre">../mock_user/onemoredir/DataLad-101</span></code>. The path specified in
the configuration file is thus wrong now.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> navigate back into your dataset
<span class="gp">$</span> <span class="nb">cd</span> ../DataLad-101
<span class="gp">#</span> attempt a datalad update
<span class="gp">$</span> datalad update
<span class="go">[INFO] Fetching updates for &lt;Dataset path=/home/me/dl-101/DataLad-101&gt; </span>
<span class="go">[ERROR] Cmd(&#39;/usr/bin/git&#39;) failed due to: exit code(128)</span>
<span class="go">|   cmdline: /usr/bin/git fetch --progress --prune --recurse-submodules=no -v roommate</span>
<span class="go">|   stderr: &#39;fatal: &#39;../mock_user/DataLad-101&#39; does not appear to be a git repository</span>
<span class="go">| fatal: Could not read from remote repository.</span>
<span class="go">| </span>
<span class="go">| Please make sure you have the correct access rights</span>
<span class="go">| and the repository exists.&#39; [cmd.py:wait:415] (GitCommandError) </span>
</pre></div>
</div>
<p>Here we go:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;fatal: &#39;</span><span class="o">../</span><span class="n">mock_user</span><span class="o">/</span><span class="n">DataLad</span><span class="o">-</span><span class="mi">101</span><span class="s1">&#39; does not appear to be a git repository</span>
 <span class="n">fatal</span><span class="p">:</span> <span class="n">Could</span> <span class="ow">not</span> <span class="n">read</span> <span class="kn">from</span> <span class="nn">remote</span> <span class="n">repository</span><span class="o">.</span>
</pre></div>
</div>
<p>Git seems pretty insistent (given the amount of error messages) that
it can not seem to find a Git repository at the location the <code class="docutils literal notranslate"><span class="pre">.git/config</span></code>
file specified. Luckily, we can provide this information. Edit the file with
an editor of your choice and fix the path from
<code class="docutils literal notranslate"><span class="pre">url</span> <span class="pre">=</span> <span class="pre">../mock_user/DataLad-101</span></code> to
<code class="docutils literal notranslate"><span class="pre">url</span> <span class="pre">=</span> <span class="pre">../mock_user/onemoredir/DataLad-101</span></code>.</p>
<p>Below, we are using the stream editor <a class="reference external" href="https://en.wikipedia.org/wiki/Sed">sed</a>
for this operation.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> sed -i <span class="s1">&#39;s/..\/mock_user\/DataLad-101/..\/mock_user\/onemoredir\/DataLad-101/&#39;</span> .git/config
</pre></div>
</div>
<p>This is how the file looks now:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> cat .git/config
<span class="go">[core]</span>
<span class="go">	repositoryformatversion = 0</span>
<span class="go">	filemode = true</span>
<span class="go">	bare = false</span>
<span class="go">	logallrefupdates = true</span>
<span class="go">	editor = nano</span>
<span class="go">[annex]</span>
<span class="go">	uuid = 8c154892-26d4-4130-bbe0-51c49154ad55</span>
<span class="go">	version = 5</span>
<span class="go">	backends = MD5E</span>
<span class="go">[submodule &quot;recordings/longnow&quot;]</span>
<span class="go">	url = https://github.com/datalad-datasets/longnow-podcasts.git</span>
<span class="go">	active = true</span>
<span class="hll"><span class="go">[remote &quot;roommate&quot;]</span>
</span><span class="go">	url = ../mock_user/onemoredir/DataLad-101</span>
<span class="go">	fetch = +refs/heads/*:refs/remotes/roommate/*</span>
<span class="go">	annex-uuid = 00a600d7-8535-4f76-abf5-93639b0f4ad5</span>
<span class="go">	annex-ignore = false</span>
<span class="go">[submodule &quot;longnow&quot;]</span>
<span class="go">	url = https://github.com/datalad-datasets/longnow-podcasts.git</span>
<span class="go">	active = true</span>
</pre></div>
</div>
<p>Let’s try to update now:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad update
<span class="go">[INFO] Fetching updates for &lt;Dataset path=/home/me/dl-101/DataLad-101&gt; </span>
<span class="go">update(ok): . (dataset)</span>
</pre></div>
</div>
<p>Nice! We fixed it!
Therefore, if a dataset you move or rename is known to other
datasets from its path, or identifies siblings with paths,
make sure to adjust them in the <code class="docutils literal notranslate"><span class="pre">.git/config</span></code> file.</p>
<p>To clean up, we’ll redo the move of the dataset and the
modification in <code class="docutils literal notranslate"><span class="pre">.git/config</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> ../mock_user <span class="o">&amp;&amp;</span> mv onemoredir/DataLad-101 .
<span class="gp">$</span> rm -r onemoredir
<span class="gp">$</span> <span class="nb">cd</span> ../DataLad-101 <span class="o">&amp;&amp;</span> git reset --hard master
<span class="go">HEAD is now at 110f3d9 add note on DataLads procedures</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="deleting-annexed-files-directories">
<h2>Deleting (annexed) files/directories<a class="headerlink" href="#deleting-annexed-files-directories" title="Permalink to this headline">¶</a></h2>
<p>Removing files from a dataset is possible in two different ways:
Either by removing the file from the current state of the repository
(which Git calls the <em>worktree</em>) but keeping the content in the history
of the dataset, or by removing content entirely from a dataset and its
history.</p>
<div class="section" id="removing-a-file-but-keeping-content-in-history">
<h3>Removing a file, but keeping content in history<a class="headerlink" href="#removing-a-file-but-keeping-content-in-history" title="Permalink to this headline">¶</a></h3>
<p>An <code class="docutils literal notranslate"><span class="pre">rm</span> <span class="pre">&lt;file&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">rm</span> <span class="pre">-rf</span> <span class="pre">&lt;directory&gt;</span></code> with a subsequent <strong class="command">datalad save</strong>
will remove a file or directory, and save its removal. The file content however will
still be in the history of the dataset, and the file can be brought back to existence
by going back into the history of the dataset or reverting the removal commit:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># download a file
$ datalad download-url -m &quot;Added flower mosaic from wikimedia&quot; \
  https://upload.wikimedia.org/wikipedia/commons/a/a5/Flower_poster_2.jpg \
  --path flowers.jpg
$ ls -l flowers.jpg
[INFO] Downloading &#39;https://upload.wikimedia.org/wikipedia/commons/a/a5/Flower_poster_2.jpg&#39; into &#39;flowers.jpg&#39; 
download_url(ok): flowers.jpg (file)
add(ok): flowers.jpg (file)
save(ok): . (dataset)
action summary:
  add (ok: 1)
  download_url (ok: 1)
  save (ok: 1)
lrwxrwxrwx 1 adina adina 128 Oct  6  2013 flowers.jpg -&gt; .git/annex/objects/7q/9Z/MD5E-s4487679--3898ef0e3497a89fa1ea74698992bf51.jpg/MD5E-s4487679--3898ef0e3497a89fa1ea74698992bf51.jpg
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> removal is easy:
<span class="gp">$</span> rm flowers.jpg
</pre></div>
</div>
<p>This will lead to a dirty dataset status:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad status
<span class="go">  deleted: flowers.jpg (symlink)</span>
</pre></div>
</div>
<p>If a removal happened by accident, a <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">--</span> <span class="pre">flowers.jpg</span></code> would undo
the removal at this stage. To stick with the removal and clean up the dataset
state, <strong class="command">datalad save</strong> will suffice:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad save -m <span class="s2">&quot;removed file again&quot;</span>
<span class="go">delete(ok): flowers.jpg (file)</span>
<span class="go">save(ok): . (dataset)</span>
<span class="go">action summary:</span>
<span class="go">  delete (ok: 1)</span>
<span class="go">  save (ok: 1)</span>
</pre></div>
</div>
<p>This commits the deletion of the file in the dataset’s history.
If this commit is reverted, the file comes back to existence:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git reset --hard HEAD~1
<span class="gp">$</span> ls
<span class="go">HEAD is now at f1e03c1 Added flower mosaic from wikimedia</span>
<span class="go">books</span>
<span class="go">code</span>
<span class="hll"><span class="go">flowers.jpg</span>
</span><span class="go">notes.txt</span>
<span class="go">recordings</span>
</pre></div>
</div>
<p>In other words, with an <strong class="command">rm</strong> and subsequent <strong class="command">datalad save</strong>,
the symlink is removed, but the content is retained in the history.</p>
</div>
<div class="section" id="removing-annexed-content-entirely">
<span id="remove"></span><h3>Removing annexed content entirely<a class="headerlink" href="#removing-annexed-content-entirely" title="Permalink to this headline">¶</a></h3>
<p id="index-0">A different command to remove file content entirely and irreversibly from a repository is
the <strong class="command">datalad drop</strong> command (<em class="manpage"><a class="manpage reference external" href="http://docs.datalad.org/generated/man/datalad-drop.html">datalad-drop</a></em> manual).
One use case for this is to make a repository more lean. Think about a
situation in which a very large result file is computed by default
in some analysis, but is not relevant for any project, and one may want to remove it.</p>
<p>If an entire dataset is specified, all file content in sub-<em>directories</em> is
dropped automatically, but for content in sub-<em>datasets</em> to be dropped, the
<code class="docutils literal notranslate"><span class="pre">-r/--recursive</span></code> flag has to be included.</p>
<p>The command will drop file content or directory content from a dataset,
but will retain a symlink for this file.
By default, DataLad will not drop any content that does not have at least
one verified remote copy that the content could be retrieved from again.
It is possible to drop the downloaded image, because thanks to
<strong class="command">datalad download-url</strong> its original location in the web in known:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad drop flowers.jpg
<span class="go">drop(ok): /home/me/dl-101/DataLad-101/flowers.jpg (file) [checking https://upload.wikimedia.org/wikipedia/commons/a/a5/Flower_poster_2.jpg...]</span>
</pre></div>
</div>
<p>Currently, the file content is gone, but the symlink still exist. Opening the
remaining symlink will fail, but the content can be obtained easily again with
<strong class="command">datalad get</strong>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad get flowers.jpg
<span class="go">get(ok): flowers.jpg (file) [from web...]</span>
</pre></div>
</div>
<p>If a file has no verified remote copies, DataLad will only drop its
content if the <code class="docutils literal notranslate"><span class="pre">--nocheck</span></code> option is specified. We will demonstrate
this by generating a random PDF file:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> convert xc:none -page Letter a.pdf
<span class="gp">$</span> datalad save -m <span class="s2">&quot;add empty pdf&quot;</span>
<span class="go">add(ok): a.pdf (file)</span>
<span class="go">save(ok): . (dataset)</span>
<span class="go">action summary:</span>
<span class="go">  add (ok: 1)</span>
<span class="go">  save (ok: 1)</span>
</pre></div>
</div>
<p>DataLad will safeguard dropping content that it can not retrieve again:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad drop a.pdf
<span class="go">[WARNING] Running drop resulted in stderr output: git-annex: drop: 1 failed</span>
<span class="go"> </span>
<span class="go">[ERROR] unsafe; Could only verify the existence of 0 out of 1 necessary copies; Rather than dropping this file, try using: git annex move; (Use --force to override this check, or adjust numcopies.) [drop(/home/me/dl-101/DataLad-101/a.pdf)] </span>
<span class="go">drop(error): /home/me/dl-101/DataLad-101/a.pdf (file) [unsafe; Could only verify the existence of 0 out of 1 necessary copies; Rather than dropping this file, try using: git annex move; (Use --force to override this check, or adjust numcopies.)]</span>
</pre></div>
</div>
<p>But with the <code class="docutils literal notranslate"><span class="pre">--nocheck</span></code> flag it will work:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad drop --nocheck a.pdf
<span class="go">drop(ok): /home/me/dl-101/DataLad-101/a.pdf (file)</span>
</pre></div>
</div>
<p>Note though that this file content is irreversibly gone now, and
even going back in time in the history of the dataset will not bring it
back into existence.</p>
<p>Finally, let’s clean up:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git reset --hard HEAD~2
<span class="go">HEAD is now at 110f3d9 add note on DataLads procedures</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="uninstalling-or-deleting-subdatasets">
<h2>Uninstalling or deleting subdatasets<a class="headerlink" href="#uninstalling-or-deleting-subdatasets" title="Permalink to this headline">¶</a></h2>
<p id="index-1">Depending on the exact aim, two commands are of relevance for
deleting a DataLad subdataset. The softer (and not so much “deleting” version)
is to uninstall a dataset with the <strong class="command">datalad uninstall</strong>
(<em class="manpage"><a class="manpage reference external" href="http://docs.datalad.org/generated/man/datalad-uninstall.html">datalad-uninstall</a></em> manual).
This command can be used to uninstall any number of
<em>subdatasets</em>. Note though that only subdatasets can be uninstalled; the command
will error if given a sub-<em>directory</em>, a file, or a top-level dataset.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> Install a subdataset - the content is irrelevant, so why not a cloud :<span class="o">)</span>
<span class="gp">$</span> datalad install -d . <span class="se">\</span>
 --source https://github.com/datalad-datasets/disneyanimation-cloud.git <span class="se">\</span>
 cloud
<span class="go">[INFO] Cloning https://github.com/datalad-datasets/disneyanimation-cloud.git [1 other candidates] into &#39;/home/me/dl-101/DataLad-101/cloud&#39; </span>
<span class="go">[INFO]   Remote origin not usable by git-annex; setting annex-ignore </span>
<span class="go">install(ok): cloud (dataset)</span>
<span class="go">action summary:</span>
<span class="go">  add (ok: 2)</span>
<span class="go">  install (ok: 1)</span>
<span class="go">  save (ok: 1)</span>
</pre></div>
</div>
<p>To uninstall the dataset, use</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad uninstall cloud
<span class="go">uninstall(ok): cloud (dataset)</span>
<span class="go">action summary:</span>
<span class="go">  drop (notneeded: 1)</span>
<span class="go">  uninstall (ok: 1)</span>
</pre></div>
</div>
<p>Note that the dataset is still known in the dataset, and not completely removed.
A <code class="docutils literal notranslate"><span class="pre">datalad</span> <span class="pre">install</span> <span class="pre">cloud</span></code> or <code class="docutils literal notranslate"><span class="pre">datalad</span> <span class="pre">get</span> <span class="pre">cloud</span></code> would reinstall the
dataset.</p>
<p id="index-2">In case one wants to fully delete a subdataset from a dataset, the
<strong class="command">datalad remove</strong> command (<em class="manpage"><a class="manpage reference external" href="http://docs.datalad.org/generated/man/datalad-remove.html">datalad-remove</a></em> manual) is
relevant<a class="footnote-reference brackets" href="#f2" id="id3">2</a>.
It needs a pointer to the root of the superdataset with the <code class="docutils literal notranslate"><span class="pre">-d/--dataset</span></code>
flag, a path to the subdataset to be removed, and optionally a commit message
(<code class="docutils literal notranslate"><span class="pre">-m/--message</span></code>) or recursive specification (<code class="docutils literal notranslate"><span class="pre">-r/--recursive</span></code>).
To remove a subdataset, we will install the uninstalled subdataset again, and
subsequently remove it with the <strong class="command">datalad remove</strong> command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad install cloud
<span class="gp">#</span> delete the subdataset
<span class="gp">$</span> datalad remove -m <span class="s2">&quot;remove obsolete subds&quot;</span> -d . cloud
<span class="go">[INFO] Cloning https://github.com/datalad-datasets/disneyanimation-cloud.git [1 other candidates] into &#39;/home/me/dl-101/DataLad-101/cloud&#39; </span>
<span class="go">[INFO]   Remote origin not usable by git-annex; setting annex-ignore </span>
<span class="go">install(ok): /home/me/dl-101/DataLad-101/cloud (dataset) [Installed subdataset in order to get /home/me/dl-101/DataLad-101/cloud]</span>
<span class="go">uninstall(ok): cloud (dataset)</span>
<span class="go">remove(ok): cloud (dataset)</span>
<span class="go">save(ok): . (dataset)</span>
<span class="go">action summary:</span>
<span class="go">  drop (notneeded: 1)</span>
<span class="go">  remove (ok: 1)</span>
<span class="go">  save (ok: 1)</span>
<span class="go">  uninstall (ok: 1)</span>
</pre></div>
</div>
<p>Note that for both commands a pointer to the <em>current directory</em> will not work.
<code class="docutils literal notranslate"><span class="pre">datalad</span> <span class="pre">remove</span> <span class="pre">.</span></code> or <code class="docutils literal notranslate"><span class="pre">datalad</span> <span class="pre">uninstall</span> <span class="pre">.</span></code> will fail, even if
the command is executed in a subdataset instead of the top-level
superdataset – you need to execute the command from a higher-level directory.</p>
<p>Finally, after this last piece of information, let’s clean up:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git reset --hard HEAD~2
<span class="go">HEAD is now at 110f3d9 add note on DataLads procedures</span>
</pre></div>
</div>
</div>
<div class="section" id="deleting-a-superdataset">
<h2>Deleting a superdataset<a class="headerlink" href="#deleting-a-superdataset" title="Permalink to this headline">¶</a></h2>
<p>If for whatever reason you at one point tried to remove a DataLad dataset,
whether with a GUI or the command line call <code class="docutils literal notranslate"><span class="pre">rm</span> <span class="pre">-rf</span> <span class="pre">&lt;directory&gt;</span></code>, you likely
have seen permission denied errors such as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rm</span><span class="p">:</span> <span class="n">cannot</span> <span class="n">remove</span> <span class="s1">&#39;&lt;directory&gt;/.git/annex/objects/Mz/M1/MD5E-s422982--2977b5c6ea32de1f98689bc42613aac7.jpg/MD5E-s422982--2977b5c6ea32de1f98689bc42613aac7.jpg&#39;</span><span class="p">:</span> <span class="n">Permission</span> <span class="n">denied</span>
<span class="n">rm</span><span class="p">:</span> <span class="n">cannot</span> <span class="n">remove</span> <span class="s1">&#39;&lt;directory&gt;/.git/annex/objects/FP/wv/MD5E-s543180--6209797211280fc0a95196b0f781311e.jpg/MD5E-s543180--6209797211280fc0a95196b0f781311e.jpg&#39;</span><span class="p">:</span> <span class="n">Permission</span> <span class="n">denied</span>
<span class="p">[</span><span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
<p>This error indicates that there is write-protected content within <code class="docutils literal notranslate"><span class="pre">.git</span></code> that
cannot not be deleted. What is this write-protected content? It’s the file content
stored in the object tree of Git-annex. If you want, you can re-read the section on
<a class="reference internal" href="101-115-symlinks.html#symlink"><span class="std std-ref">Data integrity</span></a> to find out how Git-annex revokes write permission for the user
to protect the file content given to it. To remove a dataset with annexed content
one has to regain write permissions to everything in the dataset. This is done
with the <a class="reference external" href="https://en.wikipedia.org/wiki/Chmod">chmod</a> command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chmod</span> <span class="o">-</span><span class="n">R</span> <span class="n">u</span><span class="o">+</span><span class="n">w</span> <span class="o">&lt;</span><span class="n">dataset</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This <em>recursively</em> (<code class="docutils literal notranslate"><span class="pre">-R</span></code>, i.e., throughout all files and (sub)directories) gives users
(<code class="docutils literal notranslate"><span class="pre">u</span></code>) write permissions (<code class="docutils literal notranslate"><span class="pre">+w</span></code>) for the dataset.</p>
<p>Afterwards, <code class="docutils literal notranslate"><span class="pre">rm</span> <span class="pre">-rf</span> <span class="pre">&lt;dataset&gt;</span></code> will succeed.</p>
<p>However, instead of <code class="docutils literal notranslate"><span class="pre">rm</span> <span class="pre">-rf</span></code>, a faster way to remove a dataset is using
<strong class="command">datalad remove</strong>: Run <code class="docutils literal notranslate"><span class="pre">datalad</span> <span class="pre">remove</span> <span class="pre">&lt;dataset&gt;</span></code> outside of the
superdataset to remove a top-level dataset with all its contents. Likely,
both <code class="docutils literal notranslate"><span class="pre">--nocheck</span></code> and <code class="docutils literal notranslate"><span class="pre">--recursive</span></code> flags are necessary
to remove content that does not have verified remotes, and to traverse into subdatasets.</p>
<p>Be aware though that both ways to delete a dataset will
irretrievably delete the dataset, it’s contents, and it’s history.</p>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>To sum up, file system management operations are safe and easy.
Even if you are currently confused about one or two operations,
worry not – the take-home-message is simple: Use <code class="docutils literal notranslate"><span class="pre">datalad</span> <span class="pre">save</span></code>
whenever you move or rename files. Be mindful that a <code class="docutils literal notranslate"><span class="pre">datalad</span> <span class="pre">status</span></code>
can appear unintuitive or that symlinks can break if annexed files are moved,
but all of these problems are solved after a <strong class="command">datalad save</strong> command.
Apart from this command, having a clean dataset status prior to doing anything
is your friend as well. It will make sure that you have a neat and organized
commit history, and no accidental commits of changes unrelated to your file
system management operations. The only operation you should beware of is
moving subdatasets around – this can be a minefield.
With all of these experiences and tips, you feel confident that you know
how to handle your datasets files and directories well and worry-free.</p>
<p class="rubric">Footnotes</p>
<dl class="footnote brackets">
<dt class="label" id="f1"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>If you want to learn more about the Git-specific concepts of <em>worktree</em>,
<em>staging area</em>/<em>index</em> or <em>HEAD</em>, check out section …</p>
<div class="admonition-todo admonition" id="id4">
<p class="admonition-title">Todo</p>
<p>Write a section on this high-level Git stuff. Maybe in draft of
section on Git history…</p>
</div>
</dd>
<dt class="label" id="f2"><span class="brackets"><a class="fn-backref" href="#id3">2</a></span></dt>
<dd><p>This is indeed the only case in which <strong class="command">datalad remove</strong> is
relevant. For all other cases of content deletion a normal <code class="docutils literal notranslate"><span class="pre">rm</span></code>
with a subsequent <strong class="command">datalad save</strong> works best.</p>
</dd>
</dl>
</div>
</div>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="101-135-help.html" title="Previous document">How to get help</a>
        </li>
        <li>
          <a href="101-137-history.html" title="Next document">Back and forth in time</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>

  </body>
</html>