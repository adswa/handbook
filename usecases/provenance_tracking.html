
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Basic provenance tracking &#8212; The DataLad Handbook</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="canonical" href="http://handbook.datalad.org/usecases/provenance_tracking.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Writing a reproducible paper" href="reproducible-paper.html" />
    <link rel="prev" title="A typical collaborative data management workflow" href="collaborative_data_management.html" />
  

  

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    div.body {
      min-width: initial;
      max-width: initial;
    }
  </style>

  
  <link rel="canonical" href="https://handbook.datalad.org/usecases/provenance_tracking/"/>
  <meta property="og:url" content="https://handbook.datalad.org/usecases/provenance_tracking">
  

  <link rel="icon" type="image/png" href="https://media.readthedocs.org/images/favicon.png">

  <meta name="twitter:card" content="summary">
  <meta property="twitter:image" content="https://handbook.datalad.org/_static/social-card.jpg">
  <meta property="og:image" content="https://handbook.datalad.org/_static/social-card.jpg">
  <meta property="og:title" content="Basic provenance tracking &#8212; The DataLad Handbook">
  <meta property="og:type" content="article">
  
  <meta property="og:description" content="">


  </head><body>
  <script type="text/javascript">

  $(window).scroll(function () {
    var s = $(window).scrollTop(),
          d = $(document).height(),
          c = $(window).height();
          scrollPercent = (s / (d-c)) * 100;
          var position = scrollPercent;

     $("#progressbar").attr('value', position);
  });
  </script>

  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/logo.png" title="The DataLad Handbook"/>
  </a>
</p>

<p style="margin-left:auto; margin-right: auto;"><iframe src="https://ghbtns.com/github-btn.html?repo=book&user=datalad-handbook&type=star&count=true&size=large" allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe></p>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
<style>
.algolia-autocomplete{
  width: 100%;
  height: 1.5em
}
.algolia-autocomplete a{
  border-bottom: none !important;
}
#doc_search{
  width: 100%;
  height: 100%;
}
</style>

<progress id="progressbar" value="0" max="100"></progress>
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Basic provenance tracking</a><ul>
<li><a class="reference internal" href="#the-challenge">The Challenge</a></li>
<li><a class="reference internal" href="#the-datalad-approach">The DataLad Approach</a></li>
<li><a class="reference internal" href="#step-by-step">Step-by-Step</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="collaborative_data_management.html" title="previous chapter">A typical collaborative data management workflow</a></li>
      <li>Next: <a href="reproducible-paper.html" title="next chapter">Writing a reproducible paper</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><!-- Alabaster (krTheme++) Hacks -->
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            <div style="display:block;position:relative; margin-bottom: 1em;">
              <div style="display:block;width:100%;padding-top:12.5%;"></div>
              <div class="rpad" data-unit="8x1" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;"></div>
            </div>
            
  <div class="section" id="basic-provenance-tracking">
<span id="usecase-provenance-tracking"></span><h1>Basic provenance tracking<a class="headerlink" href="#basic-provenance-tracking" title="Permalink to this headline">¶</a></h1>
<p>This use case demonstrates how the provenance of downloaded and generated files
can be captured with DataLad by</p>
<ol class="arabic simple">
<li><p>downloading a data file from an arbitrary URL from the web</p></li>
<li><p>perform changes to this data file and</p></li>
<li><p>capture provenance for all of this</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section uses advanced Git commands and concepts on the side
that are not covered in the book. If you want to learn more about
the Git commands shown here, the <a class="reference external" href="https://git-scm.com/book/en/v2">ProGit book</a>
is an excellent resource.</p>
</div>
<div class="section" id="the-challenge">
<h2>The Challenge<a class="headerlink" href="#the-challenge" title="Permalink to this headline">¶</a></h2>
<p>Rob needs to turn in an art project at the end of the high school year.
He wants to make it as easy as possible and decides to just make a
photomontage of some pictures from the internet. When he submits the project,
he does not remember where he got the input data from, nor the exact steps to
create his project, even though he tried to take notes.</p>
</div>
<div class="section" id="the-datalad-approach">
<h2>The DataLad Approach<a class="headerlink" href="#the-datalad-approach" title="Permalink to this headline">¶</a></h2>
<p>Rob starts his art project as a DataLad dataset. When downloading the
images he wants to use for his project, he tracks where they come from.
And when he changes or creates output, he tracks how, when and why and
this was done using standard DataLad commands.
This will make it easy for him to find out or remember what he has
done in his project, and how it has been done, a long time after he
finished the project, without any note taking.</p>
</div>
<div class="section" id="step-by-step">
<h2>Step-by-Step<a class="headerlink" href="#step-by-step" title="Permalink to this headline">¶</a></h2>
<p>Rob starts by creating a dataset, because everything in a dataset can
be version controlled and tracked:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad create artproject <span class="o">&amp;&amp;</span> <span class="nb">cd</span> artproject
<span class="go">[INFO] Creating a new annex repo at /home/me/usecases/provenance/artproject </span>
<span class="go">create(ok): /home/me/usecases/provenance/artproject (dataset)</span>
</pre></div>
</div>
<p>For his art project, Rob decides to download a mosaic image composed of flowers
from Wikimedia. As a first step, he extracts some of the flowers into individual
files to reuse them later.
He uses the <strong class="command">datalad download-url</strong> command to get the resource straight
from the web, but also capture all provenance automatically, and save the
resource in his dataset together with a useful commit message:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> mkdir sources
<span class="gp">$</span> datalad download-url -m <span class="s2">&quot;Added flower mosaic from wikimedia&quot;</span> <span class="se">\</span>
  https://upload.wikimedia.org/wikipedia/commons/a/a5/Flower_poster_2.jpg <span class="se">\</span>
  --path sources/flowers.jpg
<span class="go">[INFO] Downloading &#39;https://upload.wikimedia.org/wikipedia/commons/a/a5/Flower_poster_2.jpg&#39; into &#39;sources/flowers.jpg&#39; </span>
<span class="go">download_url(ok): sources/flowers.jpg (file)</span>
<span class="go">add(ok): sources/flowers.jpg (file)</span>
<span class="go">save(ok): . (dataset)</span>
<span class="go">action summary:</span>
<span class="go">  add (ok: 1)</span>
<span class="go">  download_url (ok: 1)</span>
<span class="go">  save (ok: 1)</span>
</pre></div>
</div>
<p>If he later wants to find out where he obtained this file from, a
<strong class="command">git annex whereis</strong><a class="footnote-reference brackets" href="#f1" id="id1">1</a> command will tell him:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git annex whereis sources/flowers.jpg
<span class="go">whereis sources/flowers.jpg (2 copies) </span>
<span class="go">  	00000000-0000-0000-0000-000000000001 -- web</span>
<span class="go">   	810e9c23-bb50-4589-ae62-f6e2460b8afc -- me@meiner:~/usecases/provenance/artproject [here]</span>

<span class="go">  web: https://upload.wikimedia.org/wikipedia/commons/a/a5/Flower_poster_2.jpg</span>
<span class="go">ok</span>
</pre></div>
</div>
<p>To extract some image parts for the first step of his project, he uses
the <code class="docutils literal notranslate"><span class="pre">extract</span></code> tool from <a class="reference external" href="https://imagemagick.org/index.php">ImageMagick</a> to
extract the St. Bernard’s Lily from the upper left corner, and the pimpernel
from the upper right corner. The commands will take the
Wikimedia poster as an input and produce output files from it. To capture
provenance on this action, Rob wraps it into <strong class="command">datalad run</strong><a class="footnote-reference brackets" href="#f2" id="id2">2</a>
commands.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad run -m <span class="s2">&quot;extract st-bernard lily&quot;</span> <span class="se">\</span>
 --input <span class="s2">&quot;sources/flowers.jpg&quot;</span> <span class="se">\</span>
 --output <span class="s2">&quot;st-bernard.jpg&quot;</span> <span class="se">\</span>
 <span class="s2">&quot;convert -extract 1522x1522+0+0 sources/flowers.jpg st-bernard.jpg&quot;</span>
<span class="go">[INFO] Making sure inputs are available (this may take some time) </span>
<span class="go">[INFO] == Command start (output follows) ===== </span>
<span class="go">[INFO] == Command exit (modification check follows) ===== </span>
<span class="go">add(ok): st-bernard.jpg (file)</span>
<span class="go">save(ok): . (dataset)</span>
<span class="go">action summary:</span>
<span class="go">  add (ok: 1)</span>
<span class="go">  get (notneeded: 1)</span>
<span class="go">  save (ok: 1)</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad run -m <span class="s2">&quot;extract pimpernel&quot;</span> <span class="se">\</span>
  --input <span class="s2">&quot;sources/flowers.jpg&quot;</span> <span class="se">\</span>
  --output <span class="s2">&quot;pimpernel.jpg&quot;</span> <span class="se">\</span>
  <span class="s2">&quot;convert -extract 1522x1522+1470+1470 sources/flowers.jpg pimpernel.jpg&quot;</span>
<span class="go">[INFO] Making sure inputs are available (this may take some time) </span>
<span class="go">[INFO] == Command start (output follows) ===== </span>
<span class="go">[INFO] == Command exit (modification check follows) ===== </span>
<span class="go">add(ok): pimpernel.jpg (file)</span>
<span class="go">save(ok): . (dataset)</span>
<span class="go">action summary:</span>
<span class="go">  add (ok: 1)</span>
<span class="go">  get (notneeded: 1)</span>
<span class="go">  save (ok: 1)</span>
</pre></div>
</div>
<p>He continues to process the images, capturing all provenance with DataLad.
Later, he can always find out which commands produced or changed which file.
This information is easily accessible within the history of his dataset,
both with Git and DataLad commands such as <strong class="command">git log</strong> or
<strong class="command">datalad diff</strong>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git log --oneline HEAD~3..HEAD
<span class="go">f3c72e6 [DATALAD RUNCMD] extract pimpernel</span>
<span class="go">465af52 [DATALAD RUNCMD] extract st-bernard lily</span>
<span class="go">f8267b3 Added flower mosaic from wikimedia</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad diff -f HEAD~3
<span class="go">    added: pimpernel.jpg (file)</span>
<span class="go">    added: sources/flowers.jpg (file)</span>
<span class="go">    added: st-bernard.jpg (file)</span>
</pre></div>
</div>
<p>Based on this information, he can always reconstruct how an when
any data file came to be – across the entire life-time of a project.</p>
<p>He decides that one image manipulation for his art project will
be to displace pixels of an image by a random amount to blur the image:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad run -m <span class="s2">&quot;blur image&quot;</span> <span class="se">\</span>
   --input <span class="s2">&quot;st-bernard.jpg&quot;</span> <span class="se">\</span>
   --output <span class="s2">&quot;st-bernard-displaced.jpg&quot;</span> <span class="se">\</span>
   <span class="s2">&quot;convert -spread 10 st-bernard.jpg st-bernard-displaced.jpg&quot;</span>
<span class="go">[INFO] Making sure inputs are available (this may take some time) </span>
<span class="go">[INFO] == Command start (output follows) ===== </span>
<span class="go">[INFO] == Command exit (modification check follows) ===== </span>
<span class="go">add(ok): st-bernard-displaced.jpg (file)</span>
<span class="go">save(ok): . (dataset)</span>
<span class="go">action summary:</span>
<span class="go">  add (ok: 1)</span>
<span class="go">  get (notneeded: 1)</span>
<span class="go">  save (ok: 1)</span>
</pre></div>
</div>
<p>Because he is not completely satisfied with the first random pixel displacement,
he decides to retry the operation. Because everything was wrapped in <strong class="command">datalad run</strong>,
he can rerun the command. Rerunning the command will produce a commit, because the displacement is
random and the output file changes slightly from its previous version.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git log -1 --oneline HEAD
<span class="go">c449b14 [DATALAD RUNCMD] blur image</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad rerun c449b146f2c39dc01d22b476da362606d7a2512e
<span class="go">[INFO] Making sure inputs are available (this may take some time) </span>
<span class="go">[INFO] == Command start (output follows) ===== </span>
<span class="go">[INFO] == Command exit (modification check follows) ===== </span>
<span class="go">unlock(ok): st-bernard-displaced.jpg (file)</span>
<span class="go">add(ok): st-bernard-displaced.jpg (file)</span>
<span class="go">save(ok): . (dataset)</span>
<span class="go">action summary:</span>
<span class="go">  add (ok: 1)</span>
<span class="go">  get (notneeded: 1)</span>
<span class="go">  save (ok: 1)</span>
<span class="go">  unlock (ok: 1)</span>
</pre></div>
</div>
<p>This blur also does not yet fulfill Robs expectations, so he decides to
discard the change, using standard Git tools<a class="footnote-reference brackets" href="#f3" id="id3">3</a>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git reset --hard HEAD~1
<span class="go">HEAD is now at c449b14 [DATALAD RUNCMD] blur image</span>
</pre></div>
</div>
<p>He knows that within a DataLad dataset, he can also rerun <em>a range</em>
of commands with the <code class="docutils literal notranslate"><span class="pre">--since</span></code>  flag, and even specify alternative
starting points for rerunning them with the <code class="docutils literal notranslate"><span class="pre">--onto</span></code> flag. Every
command from commits reachable from the specified checksum until
<code class="docutils literal notranslate"><span class="pre">--since</span></code> (but not including <code class="docutils literal notranslate"><span class="pre">--since</span></code>) will be re-executed.
For example, <code class="docutils literal notranslate"><span class="pre">datalad</span> <span class="pre">rerun</span> <span class="pre">--since=HEAD~5</span></code> will re-execute any
commands in the last five commits.
<code class="docutils literal notranslate"><span class="pre">--onto</span></code> indicates where to start rerunning the commands from.
The default is <code class="docutils literal notranslate"><span class="pre">HEAD</span></code>, but anything other than HEAD will be
checked out prior to execution, such that re-execution happens in
a detached HEAD state, or checked out out on the new branch specified
by the <code class="docutils literal notranslate"><span class="pre">--branch</span></code> flag.
If <code class="docutils literal notranslate"><span class="pre">--since</span></code> is an empty string, it is set to rerun every command from the
first commit that contains a recorded command. If <code class="docutils literal notranslate"><span class="pre">--onto</span></code> is an empty
string, re-execution is performed on top to the parent of the first
run commit in the revision list specified with <code class="docutils literal notranslate"><span class="pre">--since</span></code>.
When both arguments are set to empty strings, it therefore means
“rerun all commands with HEAD at the parent of the first commit a command”.
In other words, Rob can “replay” all the history for his artproject in a single
command. Using the <code class="docutils literal notranslate"><span class="pre">--branch</span></code> option of <strong class="command">datalad rerun</strong>,
he does it on a new branch he names <code class="docutils literal notranslate"><span class="pre">replay</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad rerun --since<span class="o">=</span> --onto<span class="o">=</span> --branch<span class="o">=</span>replay
<span class="go">[INFO] Making sure inputs are available (this may take some time) </span>
<span class="go">[INFO] == Command start (output follows) ===== </span>
<span class="go">[INFO] == Command exit (modification check follows) ===== </span>
<span class="go">[INFO] Making sure inputs are available (this may take some time) </span>
<span class="go">[INFO] == Command start (output follows) ===== </span>
<span class="go">[INFO] == Command exit (modification check follows) ===== </span>
<span class="go">[INFO] Making sure inputs are available (this may take some time) </span>
<span class="go">[INFO] == Command start (output follows) ===== </span>
<span class="go">[INFO] == Command exit (modification check follows) ===== </span>
<span class="go">add(ok): st-bernard.jpg (file)</span>
<span class="go">save(ok): . (dataset)</span>
<span class="go">add(ok): pimpernel.jpg (file)</span>
<span class="go">save(ok): . (dataset)</span>
<span class="go">add(ok): st-bernard-displaced.jpg (file)</span>
<span class="go">save(ok): . (dataset)</span>
<span class="go">action summary:</span>
<span class="go">  add (ok: 3)</span>
<span class="go">  get (notneeded: 3)</span>
<span class="go">  save (ok: 3)</span>
</pre></div>
</div>
<p>Now he is on a new branch of his project, which contains “replayed” history.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git log --oneline --graph master replay
<span class="go">* 599a922 [DATALAD RUNCMD] blur image</span>
<span class="go">* a68935e [DATALAD RUNCMD] extract pimpernel</span>
<span class="go">* c6cdac3 [DATALAD RUNCMD] extract st-bernard lily</span>
<span class="go">| * c449b14 [DATALAD RUNCMD] blur image</span>
<span class="go">| * f3c72e6 [DATALAD RUNCMD] extract pimpernel</span>
<span class="go">| * 465af52 [DATALAD RUNCMD] extract st-bernard lily</span>
<span class="go">|/  </span>
<span class="go">* f8267b3 Added flower mosaic from wikimedia</span>
<span class="go">* 843e232 [DATALAD] new dataset</span>
</pre></div>
</div>
<p>He can even compare the two branches:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> datalad diff -t master -f replay
<span class="go"> modified: st-bernard-displaced.jpg (file)</span>
</pre></div>
</div>
<p>He can see that the blurring, which involved a random element,
produced different results. Because his dataset contains two branches,
he can compare the two branches using normal Git operations.
The next command, for example, marks which commits are “patch-equivalent”
between the branches.
Notice that all commits are marked as equivalent (=) except the ‘random spread’ ones.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git log --oneline --left-right --cherry-mark master...replay
<span class="gp">&gt;</span> 599a922 <span class="o">[</span>DATALAD RUNCMD<span class="o">]</span> blur image
<span class="go">= a68935e [DATALAD RUNCMD] extract pimpernel</span>
<span class="go">= c6cdac3 [DATALAD RUNCMD] extract st-bernard lily</span>
<span class="go">&lt; c449b14 [DATALAD RUNCMD] blur image</span>
<span class="go">= f3c72e6 [DATALAD RUNCMD] extract pimpernel</span>
<span class="go">= 465af52 [DATALAD RUNCMD] extract st-bernard lily</span>
</pre></div>
</div>
<p>Rob can continue processing images, and will turn in a sucessful art project.
Long after he finishes high school, he finds his dataset on his old computer
again and remembers this small project fondly.</p>
<p class="rubric">Footnotes</p>
<dl class="footnote brackets">
<dt class="label" id="f1"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>If you want to learn more about <strong class="command">git annex whereis</strong>, re-read
section <a class="reference internal" href="../basics/101-117-sharelocal2.html#sharelocal2"><span class="std std-ref">Where’s Waldo?</span></a>.</p>
</dd>
<dt class="label" id="f2"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>If you want to learn more about <strong class="command">datalad run</strong>, read on from
section <a class="reference internal" href="../basics/101-108-run.html#run"><span class="std std-ref">Keeping track</span></a>.</p>
</dd>
<dt class="label" id="f3"><span class="brackets"><a class="fn-backref" href="#id3">3</a></span></dt>
<dd><p>Find out more about working with the history of a dataset with Git in
section <a class="reference internal" href="../basics/101-136-filesystem.html#filesystem"><span class="std std-ref">Miscellaneous file system operations</span></a></p>
</dd>
</dl>
</div>
</div>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="collaborative_data_management.html" title="Previous document">A typical collaborative data management workflow</a>
        </li>
        <li>
          <a href="reproducible-paper.html" title="Next document">Writing a reproducible paper</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>

  </body>
</html>